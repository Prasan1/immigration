{% extends "base.html" %}

{% block title %}Fillable Form Templates - {{ g.branding.site_name }}{% endblock %}

{% block head %}
    <style>
        body {
            background: linear-gradient(135deg, var(--brand-primary, #667eea) 0%, var(--brand-secondary, #764ba2) 100%);
            min-height: 100vh;
        }

        .navbar {
            background: rgba(44, 62, 80, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .page-header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .template-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .template-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .badge-free {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .badge-professional {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .badge-team {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .badge-business {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .template-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 1rem;
        }

        .template-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .template-category {
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .template-description {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .template-use-case {
            background: #f8f9fa;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1rem;
            border-left: 3px solid #667eea;
        }

        .btn-use-template {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-use-template:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .btn-locked {
            background: #6c757d;
            cursor: not-allowed;
        }

        .info-banner {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .category-filter {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        }

        .filter-btn {
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            padding: 0.5rem 1.2rem;
            border-radius: 25px;
            margin: 0.3rem;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
{% endblock %}

{% block content %}
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                {% if g.branding.logo_url %}
                <img src="{{ g.branding.logo_url }}" alt="{{ g.branding.site_name }}" style="height: 40px; margin-right: 10px;">
                {% else %}
                <i class="fas fa-passport me-2"></i>
                {% endif %}
                {{ g.branding.site_name }}
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home me-1"></i>Home
                </a>
                <a class="nav-link" href="/forms">
                    <i class="fas fa-file-alt me-1"></i>USCIS Forms
                </a>
                <a class="nav-link active" href="/templates">
                    <i class="fas fa-edit me-1"></i>Form Templates
                </a>
                <a class="nav-link" href="/file-compressor">
                    <i class="fas fa-file-archive me-1"></i>File Compressor
                </a>
                <a class="nav-link" href="/pricing">
                    <i class="fas fa-tags me-1"></i>Pricing
                </a>
                {% if user %}
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                </a>
                <button class="btn btn-outline-light btn-sm ms-2" id="logoutBtn">Logout</button>
                {% else %}
                <button class="btn btn-outline-light btn-sm ms-2" id="loginBtn">
                    <i class="fas fa-sign-in-alt me-1"></i>Sign In
                </button>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1><i class="fas fa-file-contract me-3"></i>Fillable Form Templates</h1>
            <p class="lead">Professional legal forms ready to fill, print, and file</p>
        </div>
    </div>

    <div class="container">
        <div class="info-banner">
            <div class="row align-items-center">
                <div class="col-md-1 text-center">
                    <i class="fas fa-info-circle" style="font-size: 2.5rem; color: #667eea;"></i>
                </div>
                <div class="col-md-11">
                    <h5 style="margin-bottom: 0.5rem;">What are Form Templates?</h5>
                    <p style="margin-bottom: 0; color: #666;">
                        These are <strong>fillable forms</strong> that immigration attorneys use in practice.
                        Fill them out online, then print or save as PDF. Includes intake forms, declarations,
                        cover letters, and more. <span class="badge bg-primary">Premium Feature - Requires Subscription</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Category Filter -->
        <div class="category-filter">
            <div class="text-center">
                <button class="filter-btn active" data-category="all">
                    <i class="fas fa-th me-1"></i>All Templates
                </button>
                <button class="filter-btn" data-category="Client Intake">
                    <i class="fas fa-user-check me-1"></i>Client Intake
                </button>
                <button class="filter-btn" data-category="Declarations & Affidavits">
                    <i class="fas fa-file-signature me-1"></i>Declarations
                </button>
                <button class="filter-btn" data-category="Evidence & Filing Documents">
                    <i class="fas fa-folder-open me-1"></i>Filing Documents
                </button>
                <button class="filter-btn" data-category="Attorney-Client Forms">
                    <i class="fas fa-handshake me-1"></i>Attorney-Client
                </button>
                <button class="filter-btn" data-category="Employment Support Forms">
                    <i class="fas fa-briefcase me-1"></i>Employment
                </button>
            </div>
        </div>

        <!-- Templates Grid -->
        <div id="templatesContainer" class="row">
            <!-- Templates will be loaded here via JavaScript -->
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        let allTemplates = [];
        let currentCategory = 'all';

        $(document).ready(function() {
            loadTemplates();

            // Category filter
            $('.filter-btn').click(function() {
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                currentCategory = $(this).data('category');
                renderTemplates();
            });

            // Login button
            $('#loginBtn').click(function() {
                window.location.href = '/login';
            });

            // Logout button
            $('#logoutBtn').click(function() {
                $.post('/api/auth/logout', function() {
                    window.location.href = '/';
                });
            });
        });

        function loadTemplates() {
            $.get('/api/templates', function(data) {
                allTemplates = data;
                renderTemplates();
            });
        }

        function renderTemplates() {
            const container = $('#templatesContainer');
            container.empty();

            const filtered = currentCategory === 'all'
                ? allTemplates
                : allTemplates.filter(t => t.category === currentCategory);

            if (filtered.length === 0) {
                container.html(`
                    <div class="col-12 text-center" style="padding: 3rem; color: white;">
                        <i class="fas fa-inbox fa-3x mb-3" style="opacity: 0.5;"></i>
                        <h4>No templates in this category yet</h4>
                        <p>Check back soon for more templates!</p>
                    </div>
                `);
                return;
            }

            filtered.forEach(template => {
                const tierBadge = getTierBadge(template.access_level);
                const icon = getCategoryIcon(template.category);
                const hasAccess = template.has_access;

                let actionButton = '';
                if (hasAccess) {
                    actionButton = `
                        <button class="btn btn-use-template" onclick="window.location.href='${template.template_url}'">
                            <i class="fas fa-edit me-2"></i>Use This Template
                        </button>
                    `;
                } else if (template.requires_login) {
                    actionButton = `
                        <button class="btn btn-use-template btn-locked" onclick="$('#loginBtn').click()">
                            <i class="fas fa-lock me-2"></i>Sign Up to Access
                        </button>
                    `;
                } else {
                    actionButton = `
                        <button class="btn btn-use-template btn-locked" onclick="window.location.href='/pricing'">
                            <i class="fas fa-arrow-up me-2"></i>Upgrade to ${template.access_level}
                        </button>
                    `;
                }

                const card = `
                    <div class="col-md-6 col-lg-4">
                        <div class="template-card">
                            <span class="template-badge ${tierBadge.class}">${tierBadge.text}</span>
                            <div class="template-icon">
                                <i class="${icon}"></i>
                            </div>
                            <div class="template-category">${template.category}</div>
                            <div class="template-title">${template.title}</div>
                            <div class="template-description">${template.description}</div>
                            <div class="template-use-case">
                                <strong><i class="fas fa-lightbulb me-2"></i>Use Case:</strong>
                                ${template.use_case}
                            </div>
                            ${actionButton}
                        </div>
                    </div>
                `;

                container.append(card);
            });
        }

        function getTierBadge(tier) {
            const badges = {
                'free': { text: 'SOLO', class: 'badge-free' },
                'basic': { text: 'PROFESSIONAL', class: 'badge-professional' },
                'pro': { text: 'TEAM', class: 'badge-team' },
                'enterprise': { text: 'BUSINESS', class: 'badge-business' }
            };
            return badges[tier] || badges['free'];
        }

        function getCategoryIcon(category) {
            const icons = {
                'Client Intake': 'fas fa-user-check',
                'Declarations & Affidavits': 'fas fa-file-signature',
                'Evidence & Filing Documents': 'fas fa-folder-open',
                'Attorney-Client Forms': 'fas fa-handshake',
                'Employment Support Forms': 'fas fa-briefcase'
            };
            return icons[category] || 'fas fa-file-alt';
        }
    </script>
{% endblock %}
