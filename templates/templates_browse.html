{% extends "base.html" %}

{% block title %}Fillable Form Templates - {{ g.branding.site_name }}{% endblock %}

{% block head %}
    <style>
        :root {
            /* RankSewa-inspired clean palette */
            --primary-color: #0284c7;
            --secondary-color: #0d9488;
            --accent-green: #10b981;
            --text-dark: #0f172a;
            --text-muted: #64748b;
            --border-gray: #e2e8f0;
            --bg-light: #f8fafc;
        }

        body {
            background: var(--bg-light);
            min-height: 100vh;
            font-family: 'Space Grotesk', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Clean Navbar */
        .navbar {
            background: white !important;
            border-bottom: 1px solid var(--border-gray);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--text-dark) !important;
            font-family: 'Fraunces', Georgia, serif;
        }

        .navbar .nav-link {
            color: var(--text-muted) !important;
            font-weight: 500;
            border-radius: 6px;
            padding: 0.5rem 1rem !important;
        }

        .navbar .nav-link.active {
            color: var(--primary-color) !important;
            font-weight: 600;
        }

        /* Clean Page Header */
        .page-header {
            background: white;
            color: var(--text-dark);
            padding: 80px 0 60px 0;
            margin-bottom: 3rem;
            text-align: center;
            border-bottom: 1px solid var(--border-gray);
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .page-header .lead {
            position: relative;
            z-index: 1;
            color: var(--text-muted);
            font-weight: 400;
        }

        .template-card {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 10px;
            padding: 1.75rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .template-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 24px rgba(2, 132, 199, 0.15);
        }

        /* Make button stick to bottom */
        .template-card .btn-use-template {
            margin-top: auto;
        }

        /* Ensure cards in row have equal height */
        #templatesContainer {
            display: flex;
            flex-wrap: wrap;
        }

        #templatesContainer > .col-md-6,
        #templatesContainer > .col-lg-4 {
            display: flex;
        }

        .template-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 0.4rem 0.9rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-free {
            background: #E8F5E9;
            color: #16a34a;
        }

        .badge-professional {
            background: #E3F2FD;
            color: #1976d2;
        }

        .badge-team {
            background: #F3E5F5;
            color: #7b1fa2;
        }

        .badge-business {
            background: #EDE7F6;
            color: var(--brand-purple);
        }

        .template-icon {
            width: 50px;
            height: 50px;
            background: #eff6ff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 20px;
            margin-bottom: 1rem;
        }

        .template-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .template-category {
            color: var(--primary-color);
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .template-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .template-use-case {
            background: #f0f9ff;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            border-left: 3px solid var(--primary-color);
        }

        .btn-use-template {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn-use-template:hover {
            background: #0369a1;
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.25);
            color: white;
        }

        .btn-locked {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .btn-locked:hover {
            background: #94a3b8;
            transform: none;
            box-shadow: none;
        }

        .info-banner {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .info-banner h5 {
            color: var(--text-dark);
            font-weight: 600;
        }

        .info-banner p {
            color: var(--text-muted);
        }

        .info-banner .badge {
            background: var(--brand-purple);
            font-weight: 500;
        }

        .category-filter {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .filter-btn {
            border: 1px solid var(--border-gray);
            background: white;
            color: var(--text-muted);
            padding: 0.5rem 1.2rem;
            border-radius: 8px;
            margin: 0.3rem;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .filter-btn:hover {
            border-color: var(--brand-purple);
            color: var(--brand-purple);
        }

        .filter-btn.active {
            background: var(--brand-purple);
            color: white;
            border-color: var(--brand-purple);
        }
    </style>
{% endblock %}

{% block nav_templates_active %}active{% endblock %}

{% block content %}
    <div class="page-header">
        <div class="container">
            <h1><i class="fas fa-file-contract me-3"></i>Fillable Form Templates</h1>
            <p class="lead">Professional legal forms ready to fill, print, and file</p>
        </div>
    </div>

    <div class="container">
        <div class="info-banner">
            <div class="row align-items-center">
                <div class="col-md-1 text-center">
                    <i class="fas fa-info-circle" style="font-size: 2.5rem; color: #b45309;"></i>
                </div>
                <div class="col-md-11">
                    <h5 style="margin-bottom: 0.5rem;">What are Form Templates?</h5>
                    <p style="margin-bottom: 0; color: #666;">
                        These are <strong>fillable forms</strong> that immigration attorneys use in practice.
                        Fill them out online, then print or save as PDF. Includes intake forms, declarations,
                        cover letters, and more. <span class="badge bg-primary">Premium Feature - Requires Subscription</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Category Filter -->
        <div class="category-filter">
            <div class="text-center">
                <button class="filter-btn active" data-category="all">
                    <i class="fas fa-th me-1"></i>All Templates
                </button>
                <button class="filter-btn" data-category="Client Intake">
                    <i class="fas fa-user-check me-1"></i>Client Intake
                </button>
                <button class="filter-btn" data-category="Declarations & Affidavits">
                    <i class="fas fa-file-signature me-1"></i>Declarations
                </button>
                <button class="filter-btn" data-category="Evidence & Filing Documents">
                    <i class="fas fa-folder-open me-1"></i>Filing Documents
                </button>
                <button class="filter-btn" data-category="Attorney-Client Forms">
                    <i class="fas fa-handshake me-1"></i>Attorney-Client
                </button>
                <button class="filter-btn" data-category="Employment Support Forms">
                    <i class="fas fa-briefcase me-1"></i>Employment
                </button>
            </div>
        </div>

        <!-- Templates Grid -->
        <div id="templatesContainer" class="row">
            <!-- Templates will be loaded here via JavaScript -->
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        let allTemplates = [];
        let currentCategory = 'all';

        // Map internal tier names to display names
        function getTierDisplayName(internalName) {
            const tierNames = {
                'free': 'Free Starter',
                'basic': 'Complete Package',
                'complete': 'Complete Package',
                'pro': 'Immigration Preparer',
                'agency': 'Immigration Preparer',
                'enterprise': 'Immigration Preparer'
            };
            return tierNames[internalName] || internalName;
        }

        $(document).ready(function() {
            loadTemplates();

            // Category filter
            $('.filter-btn').click(function() {
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                currentCategory = $(this).data('category');
                renderTemplates();
            });

            // Login button
            $('#loginBtn').click(function() {
                window.location.href = '/login';
            });

            // Logout button
            $('#logoutBtn').click(function() {
                $.post('/api/auth/logout', function() {
                    window.location.href = '/';
                });
            });
        });

        function loadTemplates() {
            $.get('/api/templates', function(data) {
                allTemplates = data;
                renderTemplates();
            });
        }

        function renderTemplates() {
            const container = $('#templatesContainer');
            container.empty();

            const filtered = currentCategory === 'all'
                ? allTemplates
                : allTemplates.filter(t => t.category === currentCategory);

            if (filtered.length === 0) {
                container.html(`
                    <div class="col-12 text-center" style="padding: 3rem; color: white;">
                        <i class="fas fa-inbox fa-3x mb-3" style="opacity: 0.5;"></i>
                        <h4>No templates in this category yet</h4>
                        <p>Check back soon for more templates!</p>
                    </div>
                `);
                return;
            }

            filtered.forEach(template => {
                const tierBadge = getTierBadge(template.access_level);
                const icon = getCategoryIcon(template.category);
                const hasAccess = template.has_access;

                let actionButton = '';
                if (hasAccess) {
                    actionButton = `
                        <button class="btn btn-use-template" onclick="window.location.href='${template.template_url}'">
                            <i class="fas fa-edit me-2"></i>Use This Template
                        </button>
                    `;
                } else if (template.requires_login) {
                    actionButton = `
                        <button class="btn btn-use-template btn-locked" onclick="$('#loginBtn').click()">
                            <i class="fas fa-lock me-2"></i>Sign Up to Access
                        </button>
                    `;
                } else {
                    actionButton = `
                        <button class="btn btn-use-template btn-locked" onclick="window.location.href='/pricing'">
                            <i class="fas fa-arrow-up me-2"></i>Upgrade to ${getTierDisplayName(template.access_level)}
                        </button>
                    `;
                }

                const card = `
                    <div class="col-md-6 col-lg-4">
                        <div class="template-card">
                            <span class="template-badge ${tierBadge.class}">${tierBadge.text}</span>
                            <div class="template-icon">
                                <i class="${icon}"></i>
                            </div>
                            <div class="template-category">${template.category}</div>
                            <div class="template-title">${template.title}</div>
                            <div class="template-description">${template.description}</div>
                            <div class="template-use-case">
                                <strong><i class="fas fa-clipboard-check me-2"></i>Use Case:</strong>
                                ${template.use_case}
                            </div>
                            ${actionButton}
                        </div>
                    </div>
                `;

                container.append(card);
            });
        }

        function getTierBadge(tier) {
            const badges = {
                'free': { text: 'FREE', class: 'badge-free' },
                'basic': { text: 'COMPLETE PACKAGE', class: 'badge-professional' },
                'complete': { text: 'COMPLETE PACKAGE', class: 'badge-professional' },
                'pro': { text: 'AGENCY', class: 'badge-team' },
                'agency': { text: 'AGENCY', class: 'badge-team' },
                'enterprise': { text: 'AGENCY', class: 'badge-business' }
            };
            return badges[tier] || badges['free'];
        }

        function getCategoryIcon(category) {
            const icons = {
                'Client Intake': 'fas fa-user-check',
                'Declarations & Affidavits': 'fas fa-file-signature',
                'Evidence & Filing Documents': 'fas fa-folder-open',
                'Attorney-Client Forms': 'fas fa-handshake',
                'Employment Support Forms': 'fas fa-briefcase'
            };
            return icons[category] || 'fas fa-file-alt';
        }
    </script>
{% endblock %}
