{% extends "base.html" %}

{% block title %}Pricing - {{ g.branding.site_name }}{% endblock %}

{% block head %}
    <style>
        :root {
            --brand-purple: #b45309;
            --brand-deep-purple: #0f766e;
            --accent-navy: #1e293b;
            --text-dark: #111827;
            --text-muted: #6b7280;
            --border-gray: #e5e7eb;
            --bg-light: #f9fafb;
            --success-green: #16a34a;
        }

        body {
            background: white;
            min-height: 100vh;
            font-family: 'Space Grotesk', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Navbar */
        .navbar {
            background: white !important;
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(to right, #b45309, #0f766e) 1;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
        }

        .navbar-brand {
            font-weight: 800;
            color: var(--text-dark) !important;
            font-family: 'Fraunces', Georgia, serif;
        }

        .navbar .nav-link {
            color: var(--text-muted) !important;
            font-weight: 600;
            border-radius: 8px;
            padding: 0.5rem 1rem !important;
        }

        .navbar .nav-link.active {
            color: var(--brand-purple) !important;
            background: linear-gradient(135deg, rgba(180, 83, 9, 0.18) 0%, rgba(15, 118, 110, 0.18) 100%);
        }

        .navbar .btn-light {
            background: var(--accent-navy);
            color: white;
            border: none;
        }

        .disclaimer-note {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: #334155;
            border-radius: 8px;
        }

        .disclaimer-modal-header {
            background: #e2e8f0;
            border-bottom: 2px solid #cbd5e1;
        }

        .disclaimer-modal-header .modal-title {
            color: #1e293b;
            font-weight: 700;
        }

        .disclaimer-box {
            background: #f1f5f9;
            border-left: 4px solid #94a3b8;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }

        /* Dark Hero Header with US Flag Watermark */
        .pricing-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            text-align: center;
            color: white;
            padding: 4rem 0 5rem 0;
            margin-bottom: -2rem;
            position: relative;
            overflow: hidden;
        }

        /* Artistic Wavy US Flag - Inline SVG */
        .pricing-header::before {
            content: '';
            position: absolute;
            top: -10%;
            left: -5%;
            width: 110%;
            height: 120%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 600' preserveAspectRatio='none'%3E%3Cdefs%3E%3Cpattern id='stars2' x='0' y='0' width='80' height='60' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='20' cy='15' r='4' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='60' cy='15' r='4' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='40' cy='35' r='4' fill='rgba(255,255,255,0.5)'/%3E%3C/pattern%3E%3C/defs%3E%3C!-- Blue canton with stars --%3E%3Cpath d='M 0 0 Q 100 20 200 0 Q 300 -20 380 0 L 380 230 Q 300 250 200 230 Q 100 210 0 230 Z' fill='rgba(159,175,210,0.35)' /%3E%3Crect x='0' y='0' width='380' height='230' fill='url(%23stars2)' opacity='0.9'/%3E%3C!-- Wavy stripes (red) --%3E%3Cpath d='M 0 0 Q 250 20 500 0 Q 750 -20 1000 0 L 1000 46 Q 750 66 500 46 Q 250 26 0 46 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 92 Q 250 112 500 92 Q 750 72 1000 92 L 1000 138 Q 750 158 500 138 Q 250 118 0 138 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 184 Q 250 204 500 184 Q 750 164 1000 184 L 1000 230 Q 750 250 500 230 Q 250 210 0 230 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 276 Q 250 296 500 276 Q 750 256 1000 276 L 1000 322 Q 750 342 500 322 Q 250 302 0 322 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 368 Q 250 388 500 368 Q 750 348 1000 368 L 1000 414 Q 750 434 500 414 Q 250 394 0 414 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 460 Q 250 480 500 460 Q 750 440 1000 460 L 1000 506 Q 750 526 500 506 Q 250 486 0 506 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 552 Q 250 572 500 552 Q 750 532 1000 552 L 1000 600 Q 750 600 500 600 Q 250 600 0 600 Z' fill='rgba(229,135,144,0.28)'/%3E%3C!-- Flowing wave overlays --%3E%3Cpath d='M 0 100 Q 125 60 250 100 T 500 100 T 750 100 T 1000 100 L 1000 150 Q 875 190 750 150 T 500 150 T 250 150 T 0 150 Z' fill='rgba(159,175,210,0.18)' opacity='0.7'/%3E%3Cpath d='M 0 300 Q 125 340 250 300 T 500 300 T 750 300 T 1000 300 L 1000 250 Q 875 210 750 250 T 500 250 T 250 250 T 0 250 Z' fill='rgba(229,135,144,0.15)' opacity='0.6'/%3E%3Cpath d='M 0 450 Q 125 410 250 450 T 500 450 T 750 450 T 1000 450 L 1000 500 Q 875 540 750 500 T 500 500 T 250 500 T 0 500 Z' fill='rgba(159,175,210,0.15)' opacity='0.6'/%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.6;
            z-index: 0;
            animation: flagWave 35s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes flagWave {
            0%, 100% {
                transform: translateX(0) translateY(0) scale(1.05);
            }
            50% {
                transform: translateX(-1%) translateY(1%) scale(1.05);
            }
        }

        .pricing-header h1,
        .pricing-header p {
            position: relative;
            z-index: 1;
        }

        .pricing-header h1 {
            font-size: 2.6rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 1rem;
        }

        .pricing-header p {
            font-size: 1.125rem;
            color: #cbd5e1;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Pricing Container */
        .pricing-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Pricing Grid - 3 columns now */
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 1024px) {
            .pricing-grid {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        /* Pricing Cards */
        .pricing-card {
            position: relative;
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 2rem 1.75rem;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .pricing-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        /* Featured Card (Most Popular) */
        .pricing-card.featured {
            border: 2px solid var(--brand-purple);
            box-shadow: 0 10px 30px rgba(180, 83, 9, 0.15);
            transform: scale(1.05);
        }

        .pricing-card.featured:hover {
            box-shadow: 0 12px 35px rgba(180, 83, 9, 0.2);
            transform: scale(1.05) translateY(-2px);
        }

        /* Popular Badge */
        .badge-featured {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--brand-purple);
            color: white;
            padding: 0.375rem 0.875rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Plan Name */
        .tier-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        /* Pricing Display */
        .tier-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0.75rem 0;
            line-height: 1;
            text-align: center;
        }

        .tier-price small {
            font-size: 1.02rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .tier-price .one-time {
            font-size: 0.9rem;
            display: block;
            color: var(--success-green);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Description */
        .tier-description {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-gray);
            text-align: center;
            min-height: 60px;
        }

        /* Features List */
        .features-list {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
            flex-grow: 1;
        }

        .features-list li {
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: var(--text-muted);
            display: flex;
            align-items: flex-start;
            line-height: 1.5;
        }

        .features-list li i {
            color: var(--success-green);
            margin-right: 0.5rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        /* CTA Buttons */
        .btn-cta {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            transition: all 0.2s ease;
            margin-top: auto;
            cursor: pointer;
        }

        .btn-cta.btn-primary {
            background: linear-gradient(135deg, var(--brand-purple) 0%, var(--brand-deep-purple) 100%);
            color: white;
        }

        .btn-cta.btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(180, 83, 9, 0.4);
        }

        .btn-cta.btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 1px solid var(--border-gray);
        }

        .btn-cta.btn-secondary:hover {
            background: var(--bg-light);
        }

        .btn-cta.btn-dark {
            background: var(--text-dark);
            color: white;
        }

        .btn-cta.btn-dark:hover {
            background: #000;
            transform: translateY(-1px);
        }

        /* A la carte tools section */
        .tools-section {
            margin-top: 4rem;
        }

        .tools-section-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .tools-section-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .tools-section-header p {
            font-size: 0.98rem;
            color: var(--text-muted);
            margin: 0;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.75rem;
        }

        @media (max-width: 992px) {
            .tools-grid {
                grid-template-columns: 1fr;
                max-width: 600px;
                margin: 0 auto;
            }
        }

        .tool-card {
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid var(--border-gray);
            padding: 1.75rem 1.5rem;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.2s ease, transform 0.2s ease;
        }

        .tool-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        }

        .tool-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--brand-purple);
            margin-bottom: 0.25rem;
        }

        .tool-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.35rem;
        }

        .tool-included {
            font-size: 0.8rem;
            color: var(--success-green);
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .tool-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .tool-price small {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .tool-description {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1.25rem;
        }

        .tool-card .btn-tool {
            margin-top: auto;
            padding: 0.8rem 1.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 8px;
            border: 1px solid var(--border-gray);
            background: white;
            color: var(--text-dark);
            text-align: center;
            text-decoration: none;
            transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
        }

        .tool-card .btn-tool:hover {
            background: var(--bg-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        /* Comparison Table */
        .comparison-section {
            margin-top: 5rem;
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 3rem 2rem;
        }

        .comparison-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            text-align: center;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }

        .comparison-table th {
            font-weight: 600;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .comparison-table td {
            color: var(--text-muted);
        }

        .comparison-table .check {
            color: var(--success-green);
            font-size: 1.2rem;
        }

        /* FAQ Section */
        .faq-section {
            margin-top: 4rem;
        }

        .faq-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            text-align: center;
        }

        .faq-item {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .faq-item h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
        }

        .faq-item p {
            color: var(--text-muted);
            margin: 0;
            line-height: 1.6;
        }

        /* Money Back Guarantee Badge */
        .guarantee-badge {
            background: linear-gradient(135deg, rgba(180, 83, 9, 0.1) 0%, rgba(15, 118, 110, 0.1) 100%);
            border: 2px solid var(--brand-purple);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        .guarantee-badge i {
            font-size: 3rem;
            color: var(--brand-purple);
            margin-bottom: 1rem;
        }

        .guarantee-badge h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .guarantee-badge p {
            color: var(--text-muted);
            margin: 0;
        }
    </style>
{% endblock %}

{% block nav_pricing_active %}active{% endblock %}

{% block content %}
    <!-- Dark Header with US Flag Watermark -->
    <div class="pricing-header">
        <div class="container">
            <h1>File Your Marriage Green Card with Confidence</h1>
            <p>Pay once, use forever. No subscriptions, no recurring fees—just complete tools to organize your I-130 & I-485 packet.</p>
        </div>
    </div>

    <!-- Pricing Container -->
    <div class="pricing-container">
        <div class="pricing-grid">
            <!-- FREE TIER -->
            <div class="pricing-card">
                <div class="tier-name">Free Starter</div>

                <div class="tier-price">
                    $0
                </div>

                <div class="tier-description">
                    Get your feet wet with a basic I-130 checklist
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Basic I-130 checklist (view only)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Sample cover letter template</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Required forms list</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Evidence categories overview</span>
                    </li>
                </ul>

                <a href="/forms" class="btn btn-cta btn-secondary">
                    <i class="fas fa-eye me-2"></i>Browse Free Resources
                </a>
            </div>

            <!-- ONE-TIME PACKAGE (FEATURED) -->
            <div class="pricing-card featured">
                <span class="badge-featured">Most Popular</span>

                <div class="tier-name">Complete Package</div>

                <div class="tier-price">
                    $199
                    <span class="one-time">✓ One-time payment, lifetime access</span>
                </div>

                <div class="tier-description">
                    Everything you need to file I-130, I-485, I-864, I-765, I-131 with confidence
                </div>

                <div class="alert disclaimer-note" style="margin: 1rem 0; padding: 0.75rem; font-size: 0.85rem;">
                    <i class="fas fa-info-circle me-1"></i><strong>For Personal Use Only:</strong> This package is for individuals filing their own marriage-based green card. Commercial use (agencies/preparers filing for clients) requires the Immigration Preparer plan.
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Complete I-130 & I-485 checklists</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Professional cover letter templates</strong> (fill in your details)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Evidence organizer</strong> (photos, texts, financial docs)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>PDF compressor</strong> (100 compressions included)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>I-94 travel history generator</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Document review checklist</strong> (before filing)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>RFE response templates</strong> (if needed)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Passport application processing</strong> (included)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>30-day money-back guarantee</strong></span>
                    </li>
                </ul>

                <button class="btn btn-cta btn-primary" onclick="handlePurchase('complete')">
                    <i class="fas fa-shopping-cart me-2"></i>Get Complete Package - $199
                </button>
            </div>

            <!-- AGENCY/PREPARER PLAN -->
            <div class="pricing-card">
                <div class="tier-name">Immigration Preparer</div>

                <div class="tier-price">
                    $79
                    <small>/month</small>
                </div>

                <div class="tier-description">
                    For immigration consultants, preparers, and agencies filing multiple cases
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Unlimited client cases</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>All Complete Package features</strong> (for every client)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>White-label branding</strong> (your logo, colors, site name)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Team collaboration</strong> (up to 5 team members)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Client workspace management</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Remove "Powered by" footer</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Priority support</strong></span>
                    </li>
                </ul>

                <button class="btn btn-cta btn-dark" onclick="handlePurchase('agency')">
                    <i class="fas fa-briefcase me-2"></i>Start Agency Plan
                </button>
            </div>
        </div>

        <!-- Money-Back Guarantee Badge -->
        <div class="guarantee-badge">
            <i class="fas fa-shield-alt"></i>
            <h3>30-Day Money-Back Guarantee</h3>
            <p>If our Complete Package doesn't meet your expectations within 30 days, we'll refund your purchase. Full refunds available if you haven't extensively used the professional PDF generation features. We want you to be confident in your purchase.</p>
            <p class="small text-muted mt-2" style="font-size: 0.85rem;">
                <i class="fas fa-info-circle me-1"></i>
                Fair use policy: Refunds may not apply if more than 5 professional PDFs have been generated, as this indicates substantial value received.
            </p>
        </div>

        <!-- A la carte tools section -->
        <div class="tools-section">
            <div class="tools-section-header">
                <h2>Not Ready for the Full Toolkit?</h2>
                <p>Use individual tools as you go. <strong>All of these are included in the $199 Complete Package.</strong></p>
            </div>

            <div class="tools-grid">
                <!-- Tool 1: PDF & Evidence Pack -->
                <div class="tool-card">
                    <div class="tool-label">Standalone Tool</div>
                    <div class="tool-name">USCIS PDF & Evidence Pack</div>
                    <div class="tool-included">✓ Included in Complete Package</div>
                    <div class="tool-price">
                        $29 <small>one-time</small>
                    </div>
                    <p class="tool-description">
                        Compress and organize large evidence files so they meet strict USCIS upload limits. Ideal if you already prepared your packet but need to handle PDFs and file sizes.
                    </p>
                    <button class="btn-tool" onclick="handleToolPurchase('pdf_evidence_pack')">
                        <i class="fas fa-shopping-cart me-2"></i>Purchase for $29
                    </button>
                </div>

                <!-- Tool 2: Passport Application Processing -->
                <div class="tool-card">
                    <div class="tool-label">Standalone Tool</div>
                    <div class="tool-name">Passport Application Processing</div>
                    <div class="tool-included">✓ Included in Complete Package</div>
                    <div class="tool-price">
                        $12 <small>one-time</small>
                    </div>
                    <p class="tool-description">
                        Complete DS-11 passport application form with pre-filled data, professional PDF output, and comprehensive checklist. Perfect if you just need passport processing help.
                    </p>
                    <button class="btn-tool" onclick="handleToolPurchase('passport')">
                        <i class="fas fa-shopping-cart me-2"></i>Purchase for $12
                    </button>
                </div>

                <!-- Tool 3: I-94 Travel History Worksheet -->
                <div class="tool-card">
                    <div class="tool-label">Standalone Tool</div>
                    <div class="tool-name">I-94 Travel History Worksheet</div>
                    <div class="tool-included">✓ Included in Complete Package</div>
                    <div class="tool-price">
                        $19 <small>one-time</small>
                    </div>
                    <p class="tool-description">
                        Quickly turn your I-94 travel records into a clean, USCIS-ready travel history worksheet. Great if you only need help organizing past entries and exits.
                    </p>
                    <button class="btn-tool" onclick="handleToolPurchase('travel_history')">
                        <i class="fas fa-shopping-cart me-2"></i>Purchase for $19
                    </button>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section">
            <h2>Frequently Asked Questions</h2>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Why a one-time payment instead of monthly subscription?</h3>
                <p>Because you only file your marriage green card <strong>once</strong>! After you submit your I-130/I-485 packet, you wait 8-24 months for approval. You don't need a subscription during that time. Pay $199 once, keep lifetime access to your case workspace, and use all tools as needed—even years later for citizenship.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>How is this different from a lawyer?</h3>
                <p>Lawyers charge $3,000-$5,000 for marriage-based green cards. Most of that cost is for organizing documents and filling out forms—not legal strategy (since most marriage cases are straightforward). Our tools help you do the organizing yourself and save thousands. If you have a complex case (prior deportation, criminal history, etc.), consult a lawyer.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>What if I get an RFE (Request for Evidence)?</h3>
                <p>Your $199 Complete Package includes <strong>RFE response templates</strong> and guidance. You'll have lifetime access, so if you get an RFE months later, just log back in and use the templates to respond.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Can I use this if I already started filing on my own?</h3>
                <p>Absolutely! Our checklists help you verify you haven't missed anything. The PDF compressor alone is worth it—USCIS has strict 10MB file size limits for online filing, and our tool helps you compress hundreds of pages of evidence to fit.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Who is the Immigration Preparer plan for?</h3>
                <p>If you're an immigration consultant, notary, paralegal, or agency that files multiple marriage green card cases per month, the Preparer plan ($79/month) is for you. You get unlimited client cases, white-label branding, and team collaboration. If you're just filing for yourself and your spouse, get the Complete Package ($199 one-time).</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Is this legal advice?</h3>
                <p>No. We provide <strong>tools and templates</strong> to help you organize your documents. We are NOT a law firm and do not provide legal advice. If you have a complex case or legal questions, consult an immigration attorney.</p>
            </div>
        </div>

        <!-- Trust Badge -->
        <div style="text-align: center; margin-top: 4rem; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
            <p style="color: var(--text-muted); font-size: 0.9375rem; margin: 0;">
                <i class="fas fa-shield-alt me-2" style="color: var(--success-green);"></i>
                Secure payment processing powered by Stripe
            </p>
        </div>
    </div>

    <!-- Legal Disclaimer Modal (shown before checkout) -->
    <div class="modal fade" id="legalDisclaimerModal" tabindex="-1" aria-labelledby="legalDisclaimerLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            <div class="modal-header disclaimer-modal-header">
                    <h5 class="modal-title" id="legalDisclaimerLabel">
                        <i class="fas fa-exclamation-triangle me-2" style="color: #64748b;"></i>Important: Please Read Before Purchase
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 2rem;">
                    <div class="disclaimer-box">
                        <h6 style="color: #1e293b; font-weight: 700; margin-bottom: 0.75rem;">
                            <i class="fas fa-gavel me-2"></i>NOT LEGAL ADVICE
                        </h6>
                        <p style="color: #334155; font-size: 0.95rem; line-height: 1.7; margin: 0;">
                            <strong>ImmigrationTemplates.com is a software tool, not a law firm.</strong> We do not provide legal advice, legal representation, or immigration consulting services.
                        </p>
                    </div>

                    <h6 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">By clicking "I Understand & Agree" below, you acknowledge that:</h6>

                    <ul style="color: #475569; font-size: 0.95rem; line-height: 1.8; padding-left: 1.5rem;">
                        <li><strong>Our checklists, templates, and tools are for informational purposes only</strong> and do not constitute legal advice</li>
                        <li><strong>You are solely responsible</strong> for your own immigration application, filing decisions, and case outcomes</li>
                        <li><strong>We strongly recommend consulting with a licensed immigration attorney</strong> for case-specific guidance, especially if you have complicating factors (criminal history, prior denials, etc.)</li>
                        <li><strong>ImmigrationTemplates.com is not liable</strong> for any outcomes, denials, RFEs, or delays related to your immigration case</li>
                        <li><strong>If you start an application and get stuck or confused,</strong> please consult an attorney rather than proceeding incorrectly</li>
                        <li><strong>This purchase is non-refundable after 30 days,</strong> and refunds are issued at our discretion</li>
                    </ul>

                    <div class="form-check mt-4" style="background: #F1F5F9; padding: 1rem; border-radius: 8px;">
                        <input class="form-check-input" type="checkbox" id="acceptDisclaimerCheckbox" style="margin-top: 0.5rem;">
                        <label class="form-check-label" for="acceptDisclaimerCheckbox" style="color: #1e293b; font-weight: 600; font-size: 0.95rem;">
                            I have read and understand this disclaimer. I accept that ImmigrationTemplates.com is a software tool, not a law firm, and does not provide legal advice.
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="proceedToCheckoutBtn" disabled style="background: var(--accent-navy); border: none;">
                        <i class="fas fa-check-circle me-2"></i>I Understand & Agree - Proceed to Payment
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // User logged in status
        const isUserLoggedIn = {{ 'true' if user else 'false' }};
        let currentPlan = null;  // Store the plan user is trying to purchase

        function handlePurchase(plan) {
            console.log('Purchase clicked for plan:', plan);

            // Check if user is logged in
            if (!isUserLoggedIn) {
                // Redirect to login with return URL
                window.location.href = '/login?redirect=/pricing';
                return;
            }

            // Store the plan and show disclaimer modal
            currentPlan = plan;
            const modal = new bootstrap.Modal(document.getElementById('legalDisclaimerModal'));
            modal.show();

            // Reset checkbox and button state
            document.getElementById('acceptDisclaimerCheckbox').checked = false;
            document.getElementById('proceedToCheckoutBtn').disabled = true;
        }

        function proceedToCheckout() {
            if (!currentPlan) return;

            const plan = currentPlan;
            const button = document.getElementById('proceedToCheckoutBtn');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

            // Determine pricing type
            const pricingType = plan === 'complete' ? 'one_time' : 'subscription';
            const tier = plan === 'complete' ? 'complete' : 'agency';

            $.ajax({
                url: '/api/create-checkout-session',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    tier: tier,
                    pricing_type: pricingType
                }),
                success: function(response) {
                    console.log('Checkout session created:', response);
                    if (response.checkout_url) {
                        window.location.href = response.checkout_url;
                    } else {
                        alert('Error: No checkout URL received');
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-check-circle me-2"></i>I Understand & Agree - Proceed to Payment';
                    }
                },
                error: function(xhr) {
                    console.error('Checkout session error:', xhr);
                    const errorMsg = xhr.responseJSON?.error || 'Error creating checkout session. Please try again.';
                    alert(errorMsg);
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-check-circle me-2"></i>I Understand & Agree - Proceed to Payment';
                }
            });
        }

        $(document).ready(function() {
            // Enable/disable proceed button based on checkbox
            $('#acceptDisclaimerCheckbox').change(function() {
                $('#proceedToCheckoutBtn').prop('disabled', !this.checked);
            });

            // Handle proceed to checkout button click
            $('#proceedToCheckoutBtn').click(function() {
                // Close modal and proceed
                bootstrap.Modal.getInstance(document.getElementById('legalDisclaimerModal')).hide();
                proceedToCheckout();
            });

            // Logout handler
            $('#logoutBtn').click(function() {
                $.post('/api/auth/logout', function() {
                    window.location.href = '/';
                });
            });

            // Auth redirect
            $('#loginBtn').click(function() {
                window.location.href = '/login';
            });
        });

        // Handle standalone tool purchase
        function handleToolPurchase(toolType) {
            console.log('Tool purchase clicked:', toolType);

            // Check if user is logged in
            if (!isUserLoggedIn) {
                window.location.href = '/login?redirect=/pricing';
                return;
            }

            const button = event.target;
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

            $.ajax({
                url: '/api/create-tool-checkout',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ tool_type: toolType }),
                success: function(response) {
                    console.log('Tool checkout session created:', response);
                    if (response.checkout_url) {
                        window.location.href = response.checkout_url;
                    } else {
                        alert('Error: No checkout URL received');
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                },
                error: function(xhr) {
                    console.error('Tool checkout error:', xhr);
                    button.disabled = false;
                    button.innerHTML = originalText;

                    const errorResponse = xhr.responseJSON;
                    if (errorResponse) {
                        // Handle specific errors
                        if (errorResponse.redirect_url) {
                            // User already has access
                            if (confirm(errorResponse.message + '\n\nGo to tool now?')) {
                                window.location.href = errorResponse.redirect_url;
                            }
                        } else {
                            alert(errorResponse.error || 'Error creating checkout session. Please try again.');
                        }
                    } else {
                        alert('Error creating checkout session. Please try again.');
                    }
                }
            });
        }
    </script>
{% endblock %}
