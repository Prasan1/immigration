{% extends "base.html" %}

{% block title %}Pricing - {{ g.branding.site_name }}{% endblock %}

{% block head %}
    <style>
        :root {
            --brand-purple: #667eea;
            --brand-deep-purple: #764ba2;
            --accent-navy: #1e293b;
            --text-dark: #111827;
            --text-muted: #6b7280;
            --border-gray: #e5e7eb;
            --bg-light: #f9fafb;
            --success-green: #16a34a;
        }

        body {
            background: white;
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Navbar */
        .navbar {
            background: white !important;
            border-bottom: 1px solid var(--border-gray);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .navbar-brand {
            font-weight: 600;
            color: var(--text-dark) !important;
        }

        .navbar .nav-link {
            color: var(--text-muted) !important;
            font-weight: 500;
        }

        .navbar .nav-link.active {
            color: var(--brand-purple) !important;
        }

        .navbar .btn-light {
            background: var(--accent-navy);
            color: white;
            border: none;
        }

        /* Dark Hero Header with US Flag Watermark */
        .pricing-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            text-align: center;
            color: white;
            padding: 4rem 0 5rem 0;
            margin-bottom: -2rem;
            position: relative;
            overflow: hidden;
        }

        /* Artistic Wavy US Flag - Inline SVG */
        .pricing-header::before {
            content: '';
            position: absolute;
            top: -10%;
            left: -5%;
            width: 110%;
            height: 120%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 600' preserveAspectRatio='none'%3E%3Cdefs%3E%3Cpattern id='stars2' x='0' y='0' width='80' height='60' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='20' cy='15' r='4' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='60' cy='15' r='4' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='40' cy='35' r='4' fill='rgba(255,255,255,0.5)'/%3E%3C/pattern%3E%3C/defs%3E%3C!-- Blue canton with stars --%3E%3Cpath d='M 0 0 Q 100 20 200 0 Q 300 -20 380 0 L 380 230 Q 300 250 200 230 Q 100 210 0 230 Z' fill='rgba(159,175,210,0.35)' /%3E%3Crect x='0' y='0' width='380' height='230' fill='url(%23stars2)' opacity='0.9'/%3E%3C!-- Wavy stripes (red) --%3E%3Cpath d='M 0 0 Q 250 20 500 0 Q 750 -20 1000 0 L 1000 46 Q 750 66 500 46 Q 250 26 0 46 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 92 Q 250 112 500 92 Q 750 72 1000 92 L 1000 138 Q 750 158 500 138 Q 250 118 0 138 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 184 Q 250 204 500 184 Q 750 164 1000 184 L 1000 230 Q 750 250 500 230 Q 250 210 0 230 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 276 Q 250 296 500 276 Q 750 256 1000 276 L 1000 322 Q 750 342 500 322 Q 250 302 0 322 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 368 Q 250 388 500 368 Q 750 348 1000 368 L 1000 414 Q 750 434 500 414 Q 250 394 0 414 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 460 Q 250 480 500 460 Q 750 440 1000 460 L 1000 506 Q 750 526 500 506 Q 250 486 0 506 Z' fill='rgba(229,135,144,0.28)'/%3E%3Cpath d='M 0 552 Q 250 572 500 552 Q 750 532 1000 552 L 1000 600 Q 750 600 500 600 Q 250 600 0 600 Z' fill='rgba(229,135,144,0.28)'/%3E%3C!-- Flowing wave overlays --%3E%3Cpath d='M 0 100 Q 125 60 250 100 T 500 100 T 750 100 T 1000 100 L 1000 150 Q 875 190 750 150 T 500 150 T 250 150 T 0 150 Z' fill='rgba(159,175,210,0.18)' opacity='0.7'/%3E%3Cpath d='M 0 300 Q 125 340 250 300 T 500 300 T 750 300 T 1000 300 L 1000 250 Q 875 210 750 250 T 500 250 T 250 250 T 0 250 Z' fill='rgba(229,135,144,0.15)' opacity='0.6'/%3E%3Cpath d='M 0 450 Q 125 410 250 450 T 500 450 T 750 450 T 1000 450 L 1000 500 Q 875 540 750 500 T 500 500 T 250 500 T 0 500 Z' fill='rgba(159,175,210,0.15)' opacity='0.6'/%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.6;
            z-index: 0;
            animation: flagWave 35s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes flagWave {
            0%, 100% {
                transform: translateX(0) translateY(0) scale(1.05);
            }
            50% {
                transform: translateX(-1%) translateY(1%) scale(1.05);
            }
        }

        .pricing-header h1,
        .pricing-header p {
            position: relative;
            z-index: 1;
        }

        .pricing-header h1 {
            font-size: 2.6rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 1rem;
        }

        .pricing-header p {
            font-size: 1.125rem;
            color: #cbd5e1;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Pricing Container */
        .pricing-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Pricing Grid - 3 columns now */
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 1024px) {
            .pricing-grid {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        /* Pricing Cards */
        .pricing-card {
            position: relative;
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 2rem 1.75rem;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .pricing-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        /* Featured Card (Most Popular) */
        .pricing-card.featured {
            border: 2px solid var(--brand-purple);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
            transform: scale(1.05);
        }

        .pricing-card.featured:hover {
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.2);
            transform: scale(1.05) translateY(-2px);
        }

        /* Popular Badge */
        .badge-featured {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--brand-purple);
            color: white;
            padding: 0.375rem 0.875rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Plan Name */
        .tier-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        /* Pricing Display */
        .tier-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0.75rem 0;
            line-height: 1;
            text-align: center;
        }

        .tier-price small {
            font-size: 1.02rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .tier-price .one-time {
            font-size: 0.9rem;
            display: block;
            color: var(--success-green);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Description */
        .tier-description {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-gray);
            text-align: center;
            min-height: 60px;
        }

        /* Features List */
        .features-list {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
            flex-grow: 1;
        }

        .features-list li {
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: var(--text-muted);
            display: flex;
            align-items: flex-start;
            line-height: 1.5;
        }

        .features-list li i {
            color: var(--success-green);
            margin-right: 0.5rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        /* CTA Buttons */
        .btn-cta {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            transition: all 0.2s ease;
            margin-top: auto;
            cursor: pointer;
        }

        .btn-cta.btn-primary {
            background: linear-gradient(135deg, var(--brand-purple) 0%, var(--brand-deep-purple) 100%);
            color: white;
        }

        .btn-cta.btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-cta.btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 1px solid var(--border-gray);
        }

        .btn-cta.btn-secondary:hover {
            background: var(--bg-light);
        }

        .btn-cta.btn-dark {
            background: var(--text-dark);
            color: white;
        }

        .btn-cta.btn-dark:hover {
            background: #000;
            transform: translateY(-1px);
        }

        /* Comparison Table */
        .comparison-section {
            margin-top: 5rem;
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 3rem 2rem;
        }

        .comparison-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            text-align: center;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }

        .comparison-table th {
            font-weight: 600;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .comparison-table td {
            color: var(--text-muted);
        }

        .comparison-table .check {
            color: var(--success-green);
            font-size: 1.2rem;
        }

        /* FAQ Section */
        .faq-section {
            margin-top: 4rem;
        }

        .faq-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            text-align: center;
        }

        .faq-item {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .faq-item h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
        }

        .faq-item p {
            color: var(--text-muted);
            margin: 0;
            line-height: 1.6;
        }

        /* Money Back Guarantee Badge */
        .guarantee-badge {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid var(--brand-purple);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        .guarantee-badge i {
            font-size: 3rem;
            color: var(--brand-purple);
            margin-bottom: 1rem;
        }

        .guarantee-badge h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .guarantee-badge p {
            color: var(--text-muted);
            margin: 0;
        }
    </style>
{% endblock %}

{% block nav_pricing_active %}active{% endblock %}

{% block content %}
    <!-- Dark Header with US Flag Watermark -->
    <div class="pricing-header">
        <div class="container">
            <h1>File Your Marriage Green Card with Confidence</h1>
            <p>Pay once, use forever. No subscriptions, no recurring fees—just complete tools to organize your I-130 & I-485 packet.</p>
        </div>
    </div>

    <!-- Pricing Container -->
    <div class="pricing-container">
        <div class="pricing-grid">
            <!-- FREE TIER -->
            <div class="pricing-card">
                <div class="tier-name">Free Starter</div>

                <div class="tier-price">
                    $0
                </div>

                <div class="tier-description">
                    Get your feet wet with a basic I-130 checklist
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Basic I-130 checklist (view only)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Sample cover letter template</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Required forms list</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Evidence categories overview</span>
                    </li>
                </ul>

                <a href="/forms" class="btn btn-cta btn-secondary">
                    <i class="fas fa-eye me-2"></i>Browse Free Resources
                </a>
            </div>

            <!-- ONE-TIME PACKAGE (FEATURED) -->
            <div class="pricing-card featured">
                <span class="badge-featured">Most Popular</span>

                <div class="tier-name">Complete Package</div>

                <div class="tier-price">
                    $199
                    <span class="one-time">✓ One-time payment, lifetime access</span>
                </div>

                <div class="tier-description">
                    Everything you need to file I-130, I-485, I-864, I-765, I-131 with confidence
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Complete I-130 & I-485 checklists</strong> (personalized)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Auto-generated cover letters</strong> (USCIS-ready)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Evidence organizer</strong> (photos, texts, financial docs)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>PDF compressor</strong> (unlimited use—beat USCIS 10MB limits)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>I-94 travel history generator</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Document review checklist</strong> (before filing)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Interview prep guide</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>RFE response templates</strong> (if needed)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>30-day money-back guarantee</strong></span>
                    </li>
                </ul>

                <button class="btn btn-cta btn-primary" onclick="handlePurchase('complete')">
                    <i class="fas fa-shopping-cart me-2"></i>Get Complete Package - $199
                </button>
            </div>

            <!-- AGENCY/PREPARER PLAN -->
            <div class="pricing-card">
                <div class="tier-name">Immigration Preparer</div>

                <div class="tier-price">
                    $79
                    <small>/month</small>
                </div>

                <div class="tier-description">
                    For immigration consultants, preparers, and agencies filing multiple cases
                </div>

                <ul class="features-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Unlimited client cases</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>All Complete Package features</strong> (for every client)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>White-label branding</strong> (your logo, colors, site name)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Team collaboration</strong> (up to 5 team members)</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Client workspace management</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Remove "Powered by" footer</strong></span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Priority support</strong></span>
                    </li>
                </ul>

                <button class="btn btn-cta btn-dark" onclick="handlePurchase('agency')">
                    <i class="fas fa-briefcase me-2"></i>Start Agency Plan
                </button>
            </div>
        </div>

        <!-- Money-Back Guarantee Badge -->
        <div class="guarantee-badge">
            <i class="fas fa-shield-alt"></i>
            <h3>30-Day Money-Back Guarantee</h3>
            <p>If our Complete Package doesn't help you organize your marriage green card packet with confidence, we'll refund every penny. No questions asked.</p>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section">
            <h2>Frequently Asked Questions</h2>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Why a one-time payment instead of monthly subscription?</h3>
                <p>Because you only file your marriage green card <strong>once</strong>! After you submit your I-130/I-485 packet, you wait 8-24 months for approval. You don't need a subscription during that time. Pay $199 once, keep lifetime access to your case workspace, and use all tools as needed—even years later for citizenship.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>How is this different from a lawyer?</h3>
                <p>Lawyers charge $3,000-$5,000 for marriage-based green cards. Most of that cost is for organizing documents and filling out forms—not legal strategy (since most marriage cases are straightforward). Our tools help you do the organizing yourself and save thousands. If you have a complex case (prior deportation, criminal history, etc.), consult a lawyer.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>What if I get an RFE (Request for Evidence)?</h3>
                <p>Your $199 Complete Package includes <strong>RFE response templates</strong> and guidance. You'll have lifetime access, so if you get an RFE months later, just log back in and use the templates to respond.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Can I use this if I already started filing on my own?</h3>
                <p>Absolutely! Our checklists help you verify you haven't missed anything. The PDF compressor alone is worth it—USCIS has strict 10MB file size limits for online filing, and our tool helps you compress hundreds of pages of evidence to fit.</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Who is the Immigration Preparer plan for?</h3>
                <p>If you're an immigration consultant, notary, paralegal, or agency that files multiple marriage green card cases per month, the Preparer plan ($79/month) is for you. You get unlimited client cases, white-label branding, and team collaboration. If you're just filing for yourself and your spouse, get the Complete Package ($199 one-time).</p>
            </div>

            <div class="faq-item">
                <h3><i class="fas fa-question-circle me-2" style="color: var(--brand-purple);"></i>Is this legal advice?</h3>
                <p>No. We provide <strong>tools and templates</strong> to help you organize your documents. We are NOT a law firm and do not provide legal advice. If you have a complex case or legal questions, consult an immigration attorney.</p>
            </div>
        </div>

        <!-- Trust Badge -->
        <div style="text-align: center; margin-top: 4rem; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
            <p style="color: var(--text-muted); font-size: 0.9375rem; margin: 0;">
                <i class="fas fa-shield-alt me-2" style="color: var(--success-green);"></i>
                Secure payment processing powered by Stripe
            </p>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // User logged in status
        const isUserLoggedIn = {{ 'true' if user else 'false' }};

        function handlePurchase(plan) {
            console.log('Purchase clicked for plan:', plan);

            // Check if user is logged in
            if (!isUserLoggedIn) {
                // Redirect to login with return URL
                window.location.href = '/login?redirect=/pricing';
                return;
            }

            // User is logged in
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

            // Determine pricing type
            const pricingType = plan === 'complete' ? 'one_time' : 'subscription';
            const tier = plan === 'complete' ? 'complete' : 'agency';

            $.ajax({
                url: '/api/create-checkout-session',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    tier: tier,
                    pricing_type: pricingType
                }),
                success: function(response) {
                    console.log('Checkout session created:', response);
                    if (response.checkout_url) {
                        window.location.href = response.checkout_url;
                    } else {
                        alert('Error: No checkout URL received');
                        button.disabled = false;
                        button.innerHTML = plan === 'complete'
                            ? '<i class="fas fa-shopping-cart me-2"></i>Get Complete Package - $199'
                            : '<i class="fas fa-briefcase me-2"></i>Start Agency Plan';
                    }
                },
                error: function(xhr) {
                    console.error('Checkout session error:', xhr);
                    const errorMsg = xhr.responseJSON?.error || 'Error creating checkout session. Please try again.';
                    alert(errorMsg);
                    button.disabled = false;
                    button.innerHTML = plan === 'complete'
                        ? '<i class="fas fa-shopping-cart me-2"></i>Get Complete Package - $199'
                        : '<i class="fas fa-briefcase me-2"></i>Start Agency Plan';
                }
            });
        }

        $(document).ready(function() {
            // Logout handler
            $('#logoutBtn').click(function() {
                $.post('/api/auth/logout', function() {
                    window.location.href = '/';
                });
            });

            // Auth redirect
            $('#loginBtn').click(function() {
                window.location.href = '/login';
            });
        });
    </script>
{% endblock %}
