<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immigration Documents Portal</title>
    <meta name="description" content="Get organized immigration form checklists, filing fees, and mailing info in one place. Explore common USCIS forms with printable summaries and clear next steps.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="alternate icon" href="/static/favicon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clerk@latest/dist/clerk.browser.js"></script>
    <style>
        :root {
            /* RankSewa-inspired clean palette */
            --primary-color: #0284c7;
            --secondary-color: #0d9488;
            --accent-green: #10b981;
            --accent-navy: #1e3a5f;
            --brand-purple: #b45309;
            --text-dark: #0f172a;
            --text-muted: #64748b;
            --border-gray: #e2e8f0;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
        }

        body {
            font-family: 'Space Grotesk', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }

        h1, h2, h3, .page-title {
            font-family: 'Fraunces', Georgia, serif;
        }

        /* White Navbar */
        .navbar {
            background: white !important;
            border-bottom: 1px solid var(--border-gray);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .navbar-brand {
            font-weight: 600;
            color: var(--text-dark) !important;
        }

        .navbar .nav-link {
            color: var(--text-muted) !important;
            font-weight: 500;
        }

        .navbar .nav-link.active {
            color: var(--brand-purple) !important;
        }

        /* Clean Page Header */
        .page-header {
            background: var(--primary-color);
            color: white;
            padding: 100px 0 80px 0;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-header-content {
            position: relative;
            z-index: 1;
            display: inline-block;
            padding: 0;
        }

        .page-title {
            font-size: 3.6rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: white;
            text-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            letter-spacing: -0.02em;
        }

        .page-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.92);
            font-weight: 500;
            margin-bottom: 0;
            max-width: 560px;
        }

        .hero-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
            gap: 40px;
            align-items: center;
        }

        .hero-copy {
            position: relative;
            z-index: 1;
        }

        .hero-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f8fafc;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 18px;
        }

        .hero-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 28px 0 24px;
        }

        .hero-cta {
            background: white;
            color: var(--primary-color);
            border-radius: 8px;
            padding: 0.85rem 2rem;
            font-weight: 700;
            border: none;
        }

        .hero-cta:hover {
            color: var(--primary-color);
            background: #f8fafc;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.25);
        }

        .hero-secondary {
            border: 2px solid rgba(255, 255, 255, 0.8);
            color: white;
            border-radius: 8px;
            padding: 0.85rem 2rem;
            font-weight: 600;
            background: transparent;
        }

        .hero-secondary:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-color: white;
        }

        .hero-highlights {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .highlight-item {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            font-size: 0.92rem;
            font-weight: 600;
            color: #f8fafc;
        }

        .hero-card {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .hero-card h4 {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 16px;
        }

        .hero-card ul {
            list-style: none;
            padding: 0;
            margin: 0 0 18px 0;
        }

        .hero-card li {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #334155;
            font-weight: 500;
        }

        .hero-card li i {
            color: var(--brand-secondary);
        }

        .hero-card .hero-card-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--brand-secondary);
            font-weight: 700;
            text-decoration: none;
        }

        .hero-card .hero-card-cta:hover {
            color: var(--brand-primary);
        }

        .trust-strip {
            background: white;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 12px;
            align-items: center;
            margin-top: -30px;
            position: relative;
            z-index: 2;
            border: 1px solid var(--border-gray);
        }

        .trust-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .trust-item i {
            color: var(--primary-color);
            font-size: 1rem;
        }

        .section-header {
            margin: 48px 0 20px;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            max-width: 700px;
            line-height: 1.6;
        }

        .steps-grid,
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 16px;
        }

        .step-card {
            background: white;
            border-radius: 10px;
            padding: 1.25rem;
            border: 1px solid var(--border-gray);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            position: relative;
        }

        .step-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.15);
        }

        .step-card .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-color);
            color: white;
            font-weight: 700;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
        }

        .step-card h4 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .step-card p {
            color: var(--text-muted);
            margin-bottom: 0;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .feature-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 1.25rem;
            border: 1px solid var(--border-gray);
            transition: all 0.2s ease;
        }

        .feature-card:hover {
            background: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(2, 132, 199, 0.1);
        }

        .feature-card h4 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .feature-card p {
            color: var(--text-muted);
            margin-bottom: 0;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .seo-callout {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-gray);
        }

        .seo-callout strong {
            color: var(--primary-color);
        }

        .faq-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 18px;
        }

        .faq-item {
            background: white;
            border-radius: 16px;
            padding: 18px 20px;
            border: 1px solid var(--border-gray);
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
        }

        .faq-item h5 {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .faq-item p {
            color: var(--text-muted);
            margin-bottom: 0;
        }

        .main-container {
            padding: 0 0 4rem 0;
            max-width: 1400px;
            margin: 0 auto;
        }

        .search-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
            border: 1px solid var(--border-gray);
        }

        .search-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-input-wrapper .form-control {
            padding: 1rem 1rem 1rem 3rem;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            font-size: 1.05rem;
        }

        .search-input-wrapper .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(2, 132, 199, 0.15);
        }

        .search-input-wrapper .input-group-text {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            z-index: 10;
            color: var(--primary-color);
        }

        /* Clean RankSewa-style Document Cards */
        .document-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            border: 1px solid var(--border-gray);
        }

        .document-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 24px rgba(2, 132, 199, 0.15);
        }

        .document-title {
            color: var(--primary-color);
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }

        .document-description {
            color: #495057;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.25rem;
            position: relative;
            z-index: 1;
        }

        .document-category {
            background: #eff6ff;
            color: var(--primary-color);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 1rem;
            font-weight: 600;
            border: 1px solid #bae6fd;
        }

        .document-meta {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }

        .document-meta i {
            margin-right: 0.5rem;
            color: var(--secondary-color);
        }

        .btn-download {
            background: var(--accent-green);
            border: none;
            color: white;
            border-radius: 6px;
            padding: 0.6rem 1.2rem;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn-download.btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-download:hover {
            background: #059669;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
            color: white;
        }

        .btn-info {
            background: var(--primary-color);
            border: none;
            color: white;
            border-radius: 6px;
            padding: 0.6rem 1.2rem;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn-info.btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-info:hover {
            background: #0369a1;
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.25);
            color: white;
        }

        .btn-checklist {
            background: var(--secondary-color);
            border: none;
            color: white;
            border-radius: 6px;
            padding: 0.6rem 1.2rem;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn-checklist.btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-checklist:hover {
            background: #0f5b54;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.25);
            color: white;
        }

        .checklist-modal .modal-content {
            border-radius: 20px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.15),
                        0 8px 24px rgba(2, 132, 199, 0.1);
            overflow: hidden;
        }

        .checklist-modal .modal-header {
            background: linear-gradient(135deg, #0284c7 0%, #0d9488 50%, #10b981 100%);
            color: white;
            border-radius: 20px 20px 0 0;
            padding: 2rem 2.5rem;
            border-bottom: none;
            position: relative;
            overflow: hidden;
        }

        .checklist-modal .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
            pointer-events: none;
        }

        .checklist-modal .modal-header::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .checklist-modal .modal-title {
            font-weight: 700;
            font-size: 1.75rem;
            color: white;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            letter-spacing: -0.01em;
        }

        .checklist-modal .modal-title i {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .checklist-modal .btn-close {
            opacity: 0.8;
            filter: brightness(0) invert(1);
            position: relative;
            z-index: 1;
            background-size: 50%;
            padding: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checklist-modal .btn-close:hover {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .checklist-modal .modal-body {
            padding: 2.5rem;
            background: #fafbfc;
            background-image: radial-gradient(circle at top right, rgba(2, 132, 199, 0.03) 0%, transparent 50%),
                              radial-gradient(circle at bottom left, rgba(13, 148, 136, 0.03) 0%, transparent 50%);
        }

        .form-info-box {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
            position: relative;
            overflow: hidden;
        }

        .form-info-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0284c7, #0d9488, #10b981);
        }

        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.08), rgba(13, 148, 136, 0.08));
            border-radius: 10px;
            margin: 0.25rem;
            font-weight: 600;
            color: var(--text-dark);
            border: 1px solid rgba(2, 132, 199, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .info-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.15);
            border-color: #0284c7;
        }

        .info-badge i {
            color: #0284c7;
            font-size: 1.1rem;
        }

        .checklist-section-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #0284c7, #0d9488);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid transparent;
            border-image: linear-gradient(90deg, #0284c7, #0d9488, #10b981);
            border-image-slice: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checklist-section-title i {
            background: linear-gradient(135deg, #0284c7, #0d9488);
            color: white;
            padding: 0.7rem;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(2, 132, 199, 0.3);
            -webkit-text-fill-color: white;
        }

        .checklist-item {
            padding: 1.25rem 1.5rem;
            margin-bottom: 1rem;
            background: white;
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.04);
        }

        .checklist-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: linear-gradient(180deg, #0284c7, #0d9488);
            transform: scaleY(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(2, 132, 199, 0.4);
        }

        .checklist-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.03), rgba(13, 148, 136, 0.03));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .checklist-item:hover {
            border-color: #0284c7;
            box-shadow: 0 8px 24px rgba(2, 132, 199, 0.15),
                        0 4px 12px rgba(13, 148, 136, 0.1);
            transform: translateX(8px) scale(1.01);
        }

        .checklist-item:hover::before {
            transform: scaleY(1);
        }

        .checklist-item:hover::after {
            opacity: 1;
        }

        .checklist-item .form-check-input {
            width: 1.5rem;
            height: 1.5rem;
            margin-top: 0.125rem;
            border: 2px solid var(--border-gray);
            cursor: pointer;
        }

        .checklist-item .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .checklist-item .form-check-label {
            font-size: 1rem;
            color: #495057;
            cursor: pointer;
            margin-left: 0.5rem;
            line-height: 1.6;
        }

        .checklist-item .form-check-input:checked + .form-check-label {
            text-decoration: line-through;
            opacity: 0.6;
        }

        /* Premium checklist items */
        .checklist-item.premium-item {
            background: #f8fafc;
            padding: 1.25rem;
            transition: all 0.2s ease;
            border-left: 3px solid var(--primary-color);
        }

        .checklist-item.premium-item:hover {
            background: #eff6ff;
            box-shadow: 0 2px 8px rgba(2, 132, 199, 0.1);
        }

        .modal-footer {
            border-top: 1px solid rgba(226, 232, 240, 0.6);
            padding: 1.5rem 2.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 0 0 20px 20px;
            display: flex;
            gap: 1rem;
        }

        .modal-footer .btn {
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-footer .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Tab Content Fade Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-body > * {
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Quick Action Buttons */
        .quick-action-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(2, 132, 199, 0.4) !important;
        }

        .quick-action-btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(2, 132, 199, 0.25) !important;
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.05), rgba(13, 148, 136, 0.05)) !important;
        }

        .progress-indicator {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px dashed var(--border-gray);
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: var(--accent-navy);
            margin-bottom: 0.75rem;
        }

        .progress {
            height: 12px;
            border-radius: 10px;
            background: #e8e8e8;
        }

        .progress-bar {
            background: var(--accent-navy);
            border-radius: 10px;
            transition: width 0.4s ease;
        }

        .alert-neutral {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: #334155;
        }

        .alert-neutral .alert-link {
            color: #0f766e;
            font-weight: 600;
        }

        .alert-neutral i {
            color: #64748b;
        }

        /* Preview Signup CTA */
        .preview-signup-cta {
            position: relative;
            margin-top: 2rem;
            padding: 3rem 2rem;
            background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(248,249,250,0.8) 20%, rgba(248,249,250,1) 50%);
            border-radius: 12px;
            text-align: center;
        }

        .preview-signup-cta::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,1) 100%);
            pointer-events: none;
        }

        .blur-overlay {
            position: relative;
            z-index: 1;
        }

        .preview-signup-cta h5 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .preview-signup-cta .btn-primary {
            background: var(--accent-navy);
            border: none;
            padding: 12px 32px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);
            transition: all 0.3s ease;
        }

        .preview-signup-cta .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 58, 95, 0.4);
        }

        /* Modern Modal Tabs with Engaging Design */
        .modal-tabs {
            display: flex;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, #0284c7, #0d9488, #10b981);
            border-image-slice: 1;
            padding: 0.5rem 1.5rem 0;
            flex-wrap: wrap;
            gap: 0.5rem;
            box-shadow: inset 0 -2px 8px rgba(0, 0, 0, 0.03);
        }

        .tab-btn {
            position: relative;
            background: transparent;
            border: none;
            padding: 1rem 1.75rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px 12px 0 0;
            font-size: 0.95rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #0284c7, #0d9488);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px 2px 0 0;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.1), rgba(13, 148, 136, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 12px 12px 0 0;
        }

        .tab-btn:hover {
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .tab-btn:hover::after {
            opacity: 1;
        }

        .tab-btn:hover i {
            transform: scale(1.15) rotate(5deg);
        }

        .tab-btn.active {
            color: white;
            background: linear-gradient(135deg, #0284c7 0%, #0d9488 100%);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3),
                        0 2px 6px rgba(13, 148, 136, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-4px);
        }

        .tab-btn.active::before {
            transform: translateX(-50%) scaleX(1);
        }

        .tab-btn.active::after {
            opacity: 0;
        }

        .tab-btn i {
            font-size: 1.1rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-btn.active i {
            transform: scale(1.1);
        }

        /* Modern Guide Content Styles */
        .guide-section {
            margin-bottom: 2rem;
            padding: 2rem;
            background: white;
            border-radius: 16px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .guide-section::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: linear-gradient(180deg, #0284c7 0%, #0d9488 50%, #10b981 100%);
            box-shadow: 0 0 10px rgba(2, 132, 199, 0.3);
        }

        .guide-section:hover {
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.1),
                        0 4px 12px rgba(2, 132, 199, 0.15);
            transform: translateY(-2px);
        }

        .guide-section h5 {
            color: var(--text-dark);
            font-weight: 700;
            margin-bottom: 1.25rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .guide-section h5 i {
            background: linear-gradient(135deg, #0284c7, #0d9488);
            color: white;
            padding: 0.6rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.25);
        }

        .guide-section h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .guide-section ul {
            list-style: none;
            padding-left: 0;
        }

        .guide-section li {
            padding: 0.75rem 0 0.75rem 2.5rem;
            position: relative;
            line-height: 1.7;
            color: #334155;
            transition: all 0.2s ease;
        }

        .guide-section li:hover {
            padding-left: 3rem;
            color: var(--text-dark);
        }

        .guide-section li:before {
            content: "→";
            position: absolute;
            left: 0.5rem;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .guide-section li:hover:before {
            left: 0.75rem;
            transform: scale(1.2);
        }

        .tip-box {
            background: linear-gradient(135deg, rgba(2, 132, 199, 0.05), rgba(13, 148, 136, 0.05));
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            border: 1px solid rgba(2, 132, 199, 0.2);
            box-shadow: 0 2px 8px rgba(2, 132, 199, 0.08);
            position: relative;
        }

        .tip-box::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #0284c7, #0d9488);
            border-radius: 12px 0 0 12px;
        }

        .tip-box h6 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #0284c7;
            margin-bottom: 1rem;
        }

        .tip-box h6 i {
            font-size: 1.2rem;
        }

        .tip-box li {
            padding: 0.5rem 0 0.5rem 0 !important;
        }

        .tip-box li:before {
            content: none !important;
        }

        .tip-box li:hover {
            padding-left: 0 !important;
        }

        .mistake-item {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.08), rgba(100, 116, 139, 0.08));
            padding: 1rem 1.25rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 2px 8px rgba(148, 163, 184, 0.1);
            font-weight: 500;
            position: relative;
            padding-left: 2.5rem;
            transition: all 0.3s ease;
        }

        .mistake-item::before {
            content: '⚠️';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .mistake-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(148, 163, 184, 0.15);
        }

        .protip-item {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            padding: 1rem 1.25rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
            font-weight: 500;
            position: relative;
            padding-left: 2.5rem;
            transition: all 0.3s ease;
        }

        .protip-item::before {
            content: '✨';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .protip-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .filter-badge {
            background: white;
            color: var(--text-dark);
            padding: 0.7rem 1.5rem;
            border-radius: 30px;
            margin: 0.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
            border: 2px solid var(--border-gray);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .filter-badge:hover {
            background: #f8fafc;
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(2, 132, 199, 0.15);
        }

        .filter-badge.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.25);
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner-border {
            color: var(--secondary-color);
        }

        .premium-badge {
            background: #eff6ff;
            color: var(--primary-color);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
            display: inline-block;
            font-weight: 700;
            border: 1px solid #bae6fd;
        }

        .free-badge {
            background: #d1fae5;
            color: #065f46;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
            display: inline-block;
            font-weight: 700;
            border: 1px solid #a7f3d0;
        }

        /* Page Loading Bar */
        #pageLoadingBar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: var(--accent-navy);
            z-index: 9999;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(30, 58, 95, 0.5);
        }

        #pageLoadingBar.loading {
            width: 70%;
        }

        #pageLoadingBar.complete {
            width: 100%;
            opacity: 0;
            transition: width 0.1s ease, opacity 0.3s ease 0.1s;
        }

        .locked-overlay {
            position: relative;
        }

        .locked-overlay::after {
            content: '\f023';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 2rem;
            color: rgba(0, 0, 0, 0.1);
        }

        .btn-upgrade {
            background: var(--primary-color);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-upgrade:hover {
            background: #0369a1;
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.25);
            color: white;
        }

        @media (max-width: 768px) {
            .hero-grid,
            .steps-grid,
            .feature-grid,
            .faq-grid,
            .trust-strip {
                grid-template-columns: 1fr;
            }

            .hero-highlights {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 2.6rem;
            }

            .document-card {
                margin-bottom: 1rem;
            }

            .search-container {
                padding: 1rem;
            }
        }

        /* Professional Footer */
        .site-footer {
            margin-top: 80px;
            padding: 64px 0 32px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-top: 1px solid #e2e8f0;
        }

        .site-footer .footer-content {
            max-width: 1240px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .site-footer .footer-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1.2fr;
            gap: 48px;
            margin-bottom: 48px;
        }

        .site-footer .footer-column h3 {
            font-size: 1.6rem;
            font-weight: 800;
            color: #0f172a;
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }

        .site-footer .footer-tagline {
            font-size: 0.95rem;
            color: var(--brand-purple);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 16px;
        }

        .site-footer .footer-description {
            color: #64748b;
            font-size: 0.95rem;
            line-height: 1.7;
            font-weight: 400;
        }

        .site-footer .footer-column h4 {
            font-size: 0.85rem;
            font-weight: 700;
            color: #0f172a;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
        }

        .site-footer .footer-links,
        .site-footer .footer-contact {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .site-footer .footer-links li {
            margin-bottom: 12px;
        }

        .site-footer .footer-links a,
        .site-footer .footer-contact a {
            color: #64748b;
            text-decoration: none;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .site-footer .footer-links a:hover {
            color: var(--brand-purple);
            padding-left: 4px;
        }

        .site-footer .footer-contact li {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
        }

        .site-footer .footer-contact i {
            color: var(--brand-purple);
            font-size: 1rem;
        }

        .site-footer .footer-contact a:hover {
            color: var(--brand-purple);
        }

        .site-footer .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 32px;
            border-top: 1px solid #e2e8f0;
        }

        .site-footer .footer-copyright {
            color: #94a3b8;
            font-size: 0.9rem;
            margin: 0;
            font-weight: 500;
        }

        /* Trust Badges Section */
        .site-footer .footer-trust-badges {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 24px;
            padding: 32px 0;
            margin-top: 32px;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
        }

        .site-footer .trust-badge-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .site-footer .trust-badge-item i {
            color: var(--brand-purple);
            font-size: 1.1rem;
        }

        .site-footer .trust-badge-item strong {
            color: #1e293b;
            font-weight: 700;
        }

        /* Responsive Footer */
        @media (max-width: 1024px) {
            .site-footer .footer-grid {
                grid-template-columns: 1fr 1fr;
                gap: 40px;
            }

            .site-footer .footer-brand {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .site-footer {
                margin-top: 60px;
                padding: 48px 0 32px;
            }

            .site-footer .footer-content {
                padding: 0 24px;
            }

            .site-footer .footer-grid {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .site-footer .footer-brand {
                grid-column: 1;
            }

            .site-footer .footer-bottom {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .site-footer .footer-copyright {
                font-size: 0.85rem;
            }

            .site-footer .footer-trust-badges {
                gap: 16px;
                padding: 24px 0;
            }

            .site-footer .trust-badge-item {
                font-size: 0.85rem;
            }

            .site-footer .trust-badge-item i {
                font-size: 1rem;
            }
        }

        /* Toast notification animations */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>

    <!-- Dynamic branding colors -->
    <style>
        :root {
            --brand-primary: {{ g.branding.primary_color }};
            --brand-secondary: {{ g.branding.secondary_color }};
        }
    </style>
</head>
<body>
    <!-- Page Loading Indicator -->
    <div id="pageLoadingBar"></div>

    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                {% if g.branding.logo_url %}
                <img src="{{ g.branding.logo_url }}" alt="{{ g.branding.site_name }}" style="height: 40px; margin-right: 10px;">
                {% else %}
                <i class="fas fa-passport me-2"></i>
                {% endif %}
                {{ g.branding.site_name }}
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/forms">
                            <i class="fas fa-file-alt me-1"></i>Forms
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/templates">
                            <i class="fas fa-edit me-1"></i>Templates
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/file-compressor">
                            <i class="fas fa-file-archive me-1"></i>Compressor
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pricing">
                            <i class="fas fa-tags me-1"></i>Pricing
                        </a>
                    </li>
                    {% if user %}
                    <li class="nav-item">
                        <span class="navbar-text me-3" style="background: rgba(180, 83, 9, 0.12); padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.9rem; color: var(--text-dark);">
                            <i class="fas fa-user-circle me-2" style="color: var(--brand-secondary);"></i>{{ user.full_name or user.email.split('@')[0] }}
                            <span class="badge" style="background: var(--brand-secondary); color: white; margin-left: 0.5rem;">{{ user.subscription_tier.title() }}</span>
                        </span>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-danger btn-sm ms-2" id="logoutBtn">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </button>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <button class="btn btn-primary btn-sm ms-2" id="loginBtn">
                            <i class="fas fa-sign-in-alt me-1"></i>Sign In
                        </button>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <div class="hero-grid">
                <div class="hero-copy">
                    <div class="hero-pill">
                        <i class="fas fa-star"></i>
                        Start with 3 forms free, no login required
                    </div>
                    <h1 class="page-title">
                        Get immigration paperwork right the first time
                    </h1>
                    <p class="page-subtitle">
                        Find USCIS form checklists, filing fees, processing times, and mailing info in one organized workspace.
                    </p>
                    <div class="hero-actions">
                        <a href="/pricing" class="btn hero-cta">
                            <i class="fas fa-rocket me-2"></i>Start Free
                        </a>
                        <a href="#forms-library" class="btn hero-secondary">
                            <i class="fas fa-layer-group me-2"></i>Browse Forms
                        </a>
                    </div>
                    <div class="hero-highlights">
                        <div class="highlight-item">
                            <i class="fas fa-check-circle me-2"></i>Printable checklists
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-clock me-2"></i>Current processing details
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-map-marker-alt me-2"></i>Mailing address guidance
                        </div>
                    </div>
                </div>
                <div class="hero-card">
                    <h4>What you get inside the library</h4>
                    <ul>
                        <li><i class="fas fa-file-alt"></i>Form-by-form document checklists</li>
                        <li><i class="fas fa-dollar-sign"></i>Filing fees and timelines at a glance</li>
                        <li><i class="fas fa-link"></i>Official links and mailing info</li>
                        <li><i class="fas fa-edit"></i>Fillable templates with paid plans</li>
                    </ul>
                    <a class="hero-card-cta" href="/pricing">
                        Compare plans <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container main-container">
        <div class="trust-strip">
            <div class="trust-item">
                <i class="fas fa-check-double"></i>Clear, step-by-step checklists
            </div>
            <div class="trust-item">
                <i class="fas fa-link"></i>Direct links to official form PDFs
            </div>
            <div class="trust-item">
                <i class="fas fa-print"></i>Printable summaries for your records
            </div>
            <div class="trust-item">
                <i class="fas fa-users"></i>Built for self-filers and small teams
            </div>
        </div>

        <div class="section-header">
            <h2 class="section-title">How it works</h2>
            <p class="section-subtitle">
                Pick a form, follow the checklist, and move forward with confidence. Everything you need is organized in one place.
            </p>
        </div>
        <div class="steps-grid">
            <div class="step-card">
                <div class="step-number">1</div>
                <h4>Find your form</h4>
                <p>Search by form number or browse by category to get started fast.</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <h4>Follow the checklist</h4>
                <p>See required documents, fees, and timing in a clean, printable view.</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <h4>Submit with clarity</h4>
                <p>Use official links and mailing info so nothing gets missed.</p>
            </div>
        </div>

        <div class="section-header">
            <h2 class="section-title">Built for real immigration tasks</h2>
            <p class="section-subtitle">
                Whether you are applying for family, work, or naturalization, this library keeps your paperwork focused and consistent.
            </p>
        </div>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>Family-based immigration</h4>
                <p>Track supporting evidence and fee details for key family petitions.</p>
            </div>
            <div class="feature-card">
                <h4>Adjustment of status</h4>
                <p>Keep I-485 packets organized with a checklist you can print.</p>
            </div>
            <div class="feature-card">
                <h4>Naturalization</h4>
                <p>Stay ready for the N-400 process with a clean overview.</p>
            </div>
        </div>
        <!-- Free Trial Banner (for non-logged in users) -->
        {% if not user %}
        <div class="mb-4 d-flex flex-wrap align-items-center gap-3" style="font-size: 0.98rem; color: #475569;">
            <span style="background: rgba(15, 118, 110, 0.12); color: #0f766e; font-weight: 600; padding: 0.35rem 0.75rem; border-radius: 999px;">
                <i class="fas fa-clipboard-check me-1"></i>Free to start
            </span>
            <span>
                Access I-130, I-485, and N-400 checklists without logging in.
            </span>
            <a href="/pricing" style="color: var(--primary-color); font-weight: 600; text-decoration: none;">
                See full access plans
            </a>
        </div>
        {% endif %}

        <!-- User Status Banner (if logged in) -->
        {% if user %}
        <div class="alert alert-info border-0 shadow-sm mb-4" style="border-radius: 15px; background: rgba(30, 58, 95, 0.05); border-left: 4px solid var(--accent-navy) !important;">
            <div class="d-flex align-items-center">
                <i class="fas fa-info-circle fa-2x me-3" style="color: var(--accent-navy);"></i>
                <div class="flex-grow-1">
                    <strong style="color: var(--accent-navy);">{{ user.subscription_tier.title() }} Plan</strong>
                    <span class="ms-2" style="color: #6c757d;">•</span>
                    <span class="ms-2" style="color: #2c3e50; font-weight: 600;" id="accessibleCount">Loading...</span> <span style="color: #495057;">forms available</span>
                </div>
                {% if user.subscription_tier == 'free' %}
                <a href="/pricing" class="btn btn-sm" style="background: var(--accent-navy); color: white; border-radius: 20px;">
                    <i class="fas fa-arrow-up me-1"></i>Upgrade
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Search and Filter Section -->
        <div class="search-container">
            <div class="mb-4">
                <h3 class="search-title">
                    <i class="fas fa-search me-2"></i>
                    Find Your Form
                </h3>
                <div class="search-input-wrapper">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchInput"
                           placeholder="Search by form number, title, or description...">
                </div>
            </div>

            <div>
                <h6 class="mb-3" style="color: #6c757d; font-weight: 600;">
                    <i class="fas fa-filter me-2"></i>Filter by Category
                </h6>
                <div id="categoryFilters">
                    <span class="filter-badge active" data-category="all">
                        <i class="fas fa-globe me-1"></i>All Categories
                    </span>
                </div>
            </div>
        </div>

        <div class="section-header">
            <h2 class="section-title">Popular USCIS forms in one place</h2>
            <p class="section-subtitle">
                Explore checklists for I-130, I-485, N-400, I-765, and more. Print what you need and keep moving.
            </p>
        </div>

        <!-- Documents Grid -->
        <div id="forms-library"></div>
        <div id="documentsContainer">
            <div class="loading">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading immigration documents...</p>
            </div>
        </div>

        <div class="section-header">
            <h2 class="section-title">Frequently asked questions</h2>
            <p class="section-subtitle">
                Quick answers for first-time visitors. This site is for informational purposes and does not provide legal advice.
            </p>
        </div>
        <div class="faq-grid">
            <div class="faq-item">
                <h5>Is this official USCIS guidance?</h5>
                <p>No. We organize publicly available information and link to official resources for your convenience.</p>
            </div>
            <div class="faq-item">
                <h5>Do I need an account to start?</h5>
                <p>You can access three forms without logging in. Create an account to unlock the full library.</p>
            </div>
            <div class="faq-item">
                <h5>Can I print or save the checklist?</h5>
                <p>Yes. Each form includes a checklist view that is ready to print.</p>
            </div>
            <div class="faq-item">
                <h5>Does this replace an attorney?</h5>
                <p>No. This tool helps you stay organized, but it does not provide legal advice.</p>
            </div>
        </div>
    </div>

    <!-- Document Detail Modal -->
    <div class="modal fade checklist-modal" id="documentModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">
                        <i class="fas fa-clipboard-list me-2"></i>
                        Document Checklist
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <!-- Tabs -->
                <div class="modal-tabs">
                    <button class="tab-btn active" onclick="switchTab('overview')">
                        <i class="fas fa-info-circle me-1"></i>Overview
                    </button>
                    <button class="tab-btn" onclick="switchTab('how-to-fill')" id="howToFillTab" style="display:none;">
                        <i class="fas fa-pen me-1"></i>How to Fill
                    </button>
                    <button class="tab-btn" onclick="switchTab('checklist')">
                        <i class="fas fa-check-square me-1"></i>Required Documents
                    </button>
                    <button class="tab-btn" onclick="switchTab('mistakes')" id="mistakesTab" style="display:none;">
                        <i class="fas fa-exclamation-triangle me-1"></i>Common Mistakes
                    </button>
                    <button class="tab-btn" onclick="switchTab('before-submit')" id="beforeSubmitTab" style="display:none;">
                        <i class="fas fa-tasks me-1"></i>Before You Submit
                    </button>
                    <button class="tab-btn" onclick="switchTab('where-to-mail')" id="whereToMailTab">
                        <i class="fas fa-map-marker-alt me-1"></i>Where to Mail
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
                    <button type="button" class="btn" style="background: var(--accent-navy); color: white; border: none; font-weight: 500;" onclick="window.print()">
                        <i class="fas fa-print me-2"></i>Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Map internal tier names to display names
        function getTierDisplayName(internalName) {
            const tierNames = {
                'free': 'Free Starter',
                'complete': 'Complete Package',
                'agency': 'Agency',
                // Legacy tiers (backward compatibility)
                'basic': 'Complete Package',
                'pro': 'Complete Package',
                'enterprise': 'Agency'
            };
            return tierNames[internalName] || internalName;
        }

        $(document).ready(function() {
            let allDocuments = [];
            let currentFilter = 'all';

            // User subscription tier (from backend)
            {% if user %}
            const userTier = "{{ user.subscription_tier }}";
            const isAuthenticated = true;
            {% else %}
            const userTier = "anonymous";
            const isAuthenticated = false;
            {% endif %}

            // Load documents and categories
            loadDocuments();
            loadCategories();

            // Search functionality
            $('#searchInput').on('input', function() {
                filterDocuments();
            });

            // Category filter functionality
            $(document).on('click', '.filter-badge', function() {
                $('.filter-badge').removeClass('active');
                $(this).addClass('active');
                currentFilter = $(this).data('category');
                filterDocuments();
            });

            function loadDocuments() {
                $.ajax({
                    url: '/api/documents',
                    method: 'GET',
                    success: function(data) {
                        allDocuments = data;
                        renderDocuments(data);

                        // Update accessible count for logged-in users
                        const accessibleCount = data.filter(doc => doc.has_access).length;
                        $('#accessibleCount').text(accessibleCount);
                    },
                    error: function() {
                        $('#documentsContainer').html(`
                            <div class="alert alert-danger text-center">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Failed to load documents. Please try again later.
                            </div>
                        `);
                    }
                });
            }

            function loadCategories() {
                $.ajax({
                    url: '/api/categories',
                    method: 'GET',
                    success: function(categories) {
                        let filtersHtml = `
                            <span class="filter-badge active" data-category="all">
                                <i class="fas fa-globe me-1"></i>All Categories
                            </span>
                        `;
                        
                        categories.forEach(category => {
                            const icon = getCategoryIcon(category);
                            filtersHtml += `
                                <span class="filter-badge" data-category="${category}">
                                    <i class="${icon} me-1"></i>${category}
                                </span>
                            `;
                        });
                        
                        $('#categoryFilters').html(filtersHtml);
                    }
                });
            }

            function getCategoryIcon(category) {
                const icons = {
                    'Family-Based Immigration': 'fas fa-home',
                    'Adjustment of Status': 'fas fa-id-card',
                    'Naturalization': 'fas fa-flag-usa',
                    'Work Authorization': 'fas fa-briefcase',
                    'Temporary Workers': 'fas fa-clock',
                    'Status Changes': 'fas fa-exchange-alt',
                    'Travel Documents': 'fas fa-plane'
                };
                return icons[category] || 'fas fa-file-alt';
            }

            function renderDocuments(documents) {
                if (documents.length === 0) {
                    $('#documentsContainer').html(`
                        <div class="no-results">
                            <i class="fas fa-search fa-3x mb-3" style="color: #6c757d;"></i>
                            <h4>No documents found</h4>
                            <p>Try adjusting your search criteria or filters.</p>
                        </div>
                    `);
                    return;
                }

                let html = '';
                documents.forEach(doc => {
                    const categoryIcon = getCategoryIcon(doc.category);
                    const isPremium = doc.required_tier !== 'free';
                    const hasAccess = doc.has_access;
                    const lockedClass = (isPremium && !hasAccess) ? 'locked-overlay' : '';

                    html += `
                        <div class="document-card ${lockedClass}" data-category="${doc.category}">
                            <div class="row">
                                <div class="col-md-8">
                                    <h3 class="document-title">
                                        ${doc.title}
                                        ${doc.required_tier === 'free' ? `<span class="free-badge"><i class="fas fa-check-circle me-1"></i>FREE - No Login Required</span>` :
                                          isPremium ? `<span class="premium-badge"><i class="fas fa-crown me-1"></i>${getTierDisplayName(doc.required_tier)}</span>` : ''}
                                    </h3>
                                    <span class="document-category">
                                        <i class="${categoryIcon} me-1"></i>${doc.category}
                                    </span>
                                    <p class="document-description">${doc.description}</p>

                                    <div class="document-meta">
                                        <div class="mb-2">
                                            <i class="fas fa-clock"></i><strong>Processing Time:</strong> ${doc.processing_time}
                                        </div>
                                        <div class="mb-2">
                                            <i class="fas fa-dollar-sign"></i><strong>Filing Fee:</strong> ${doc.fee}
                                        </div>
                                        <div>
                                            <i class="fas fa-calendar-alt"></i><strong>Last Updated:</strong> ${formatDate(doc.last_updated)}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    ${hasAccess ? `
                                        <div class="d-flex flex-column gap-2">
                                            <a href="${doc.pdf_url}" target="_blank" class="btn btn-download btn-sm">
                                                <i class="fas fa-download me-1"></i>Download
                                            </a>
                                            <div class="d-flex gap-2">
                                                <a href="${doc.info_url}" target="_blank" class="btn btn-info btn-sm flex-fill">
                                                    <i class="fas fa-info-circle me-1"></i>Info
                                                </a>
                                                <button class="btn btn-checklist btn-sm flex-fill" onclick="showChecklist(${doc.id})">
                                                    <i class="fas fa-clipboard-list me-1"></i>Checklist
                                                </button>
                                            </div>
                                        </div>
                                    ` : doc.requires_login ? `
                                        <div class="d-flex align-items-center gap-2 mb-3 p-3" style="background: #f8fafc; border-radius: 8px; border-left: 3px solid var(--primary-color);">
                                            <i class="fas fa-lock" style="color: var(--primary-color);"></i>
                                            <span style="font-size: 0.9rem; color: var(--text-dark); flex: 1;">
                                                <strong>${getTierDisplayName(doc.required_tier)}</strong> required
                                            </span>
                                        </div>
                                        <div class="d-flex gap-2 flex-wrap">
                                            <button class="btn btn-primary btn-sm" onclick="$('#loginBtn').click()" style="flex: 1; min-width: 120px;">
                                                <i class="fas fa-user-plus me-1"></i>Sign Up
                                            </button>
                                            <a href="/pricing" class="btn btn-outline-secondary btn-sm" style="flex: 1; min-width: 120px;">
                                                <i class="fas fa-info-circle me-1"></i>View Plans
                                            </a>
                                        </div>
                                    ` : `
                                        <div class="d-flex align-items-center gap-2 mb-3 p-3" style="background: #f8fafc; border-radius: 8px; border-left: 3px solid var(--primary-color);">
                                            <i class="fas fa-arrow-up" style="color: var(--primary-color);"></i>
                                            <span style="font-size: 0.9rem; color: var(--text-dark); flex: 1;">
                                                <strong>${getTierDisplayName(doc.required_tier)}</strong> required
                                            </span>
                                        </div>
                                        <a href="/pricing" class="btn btn-primary btn-sm w-100">
                                            <i class="fas fa-unlock me-1"></i>Upgrade Plan
                                        </a>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                });

                $('#documentsContainer').html(html);
            }

            function filterDocuments() {
                const searchTerm = $('#searchInput').val().toLowerCase();
                
                let filteredDocs = allDocuments.filter(doc => {
                    const matchesSearch = doc.title.toLowerCase().includes(searchTerm) ||
                                        doc.description.toLowerCase().includes(searchTerm) ||
                                        doc.category.toLowerCase().includes(searchTerm);
                    
                    const matchesCategory = currentFilter === 'all' || doc.category === currentFilter;
                    
                    return matchesSearch && matchesCategory;
                });
                
                renderDocuments(filteredDocs);
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

            // Global function for checklist modal
            // Store current form guide data
            let currentFormGuide = null;
            let currentFormData = null;
            let currentActiveTab = 'overview';

            window.showChecklist = function(docId) {
                const doc = allDocuments.find(d => d.id === docId);
                if (!doc) return;

                if (!doc.has_access) {
                    if (doc.requires_login) {
                        alert('Please sign up to access this checklist');
                        $('#loginBtn').click();
                    } else {
                        alert('Please upgrade your subscription to access this checklist');
                        window.location.href = '/pricing';
                    }
                    return;
                }

                // Store current form data
                currentFormData = doc;
                currentActiveTab = 'overview';

                // Set modal title
                $('#modalTitle').html(`<i class="fas fa-clipboard-list me-2"></i>${doc.title}`);

                // Reset tabs
                $('.tab-btn').removeClass('active');
                $('.tab-btn[onclick="switchTab(\'overview\')"]').addClass('active');

                // Hide guide tabs initially
                $('#howToFillTab, #mistakesTab, #beforeSubmitTab').hide();

                // Show loading
                $('#modalBody').html(`
                    <div class="text-center p-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading form guide...</p>
                    </div>
                `);

                // Show modal
                $('#documentModal').modal('show');

                // Fetch form guide
                $.ajax({
                    url: `/api/form-guide/${docId}`,
                    method: 'GET',
                    success: function(response) {
                        if (response.available) {
                            currentFormGuide = response.guide;
                            // Show guide tabs
                            $('#howToFillTab, #mistakesTab, #beforeSubmitTab').show();
                        } else {
                            currentFormGuide = null;
                        }
                        // Render overview tab
                        renderTabContent('overview');
                    },
                    error: function() {
                        currentFormGuide = null;
                        renderTabContent('overview');
                    }
                });
            };

            // Tab switching function
            window.switchTab = function(tabName) {
                $('.tab-btn').removeClass('active');
                $(`.tab-btn[onclick="switchTab('${tabName}')"]`).addClass('active');
                currentActiveTab = tabName;
                renderTabContent(tabName);
            };

            // Render tab content
            function renderTabContent(tabName) {
                if (!currentFormData) return;

                let html = '';
                switch(tabName) {
                    case 'overview':
                        html = renderOverviewTab();
                        break;
                    case 'how-to-fill':
                        html = renderHowToFillTab();
                        break;
                    case 'checklist':
                        html = renderChecklistTab();
                        break;
                    case 'mistakes':
                        html = renderMistakesTab();
                        break;
                    case 'before-submit':
                        html = renderBeforeSubmitTab();
                        break;
                    case 'where-to-mail':
                        html = renderMailingTab();
                        break;
                }

                $('#modalBody').html(html);

                // Add checkbox listeners
                if (tabName === 'checklist' || tabName === 'before-submit') {
                    $('.checklist-checkbox').on('change', function() {
                        const total = $(this).data('total');
                        const checked = $('.checklist-checkbox:checked').length;
                        const percentage = (checked / total) * 100;
                        $('#checkedCount').text(checked);
                        $('#progressBar').css('width', percentage + '%');
                    });
                }
            }

            function renderOverviewTab() {
                const doc = currentFormData;
                return `
                    <div class="form-info-box">
                        <h6 style="color: var(--primary-color); font-weight: 700; margin-bottom: 1rem;">
                            <i class="fas fa-info-circle me-2"></i>Form Information
                        </h6>
                        <p style="color: #495057; margin-bottom: 1rem;">${doc.description}</p>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="info-badge"><i class="fas fa-dollar-sign"></i>${doc.fee}</span>
                            <span class="info-badge"><i class="fas fa-clock"></i>${doc.processing_time}</span>
                            <span class="info-badge"><i class="fas fa-calendar"></i>${formatDate(doc.last_updated)}</span>
                        </div>
                    </div>

                    ${currentFormGuide ? `
                        <div class="alert alert-success mt-3" style="border-radius: 12px;">
                            <h6 class="mb-2"><i class="fas fa-check-circle me-2"></i><strong>Step-by-Step Filling Guide Available!</strong></h6>
                            <p class="mb-2">Click the tabs above to see:</p>
                            <ul class="mb-0 mt-2" style="list-style: none; padding-left: 0;">
                                <li><i class="fas fa-pen me-2" style="color: var(--primary-color);"></i><strong>How to Fill</strong> - Detailed instructions</li>
                                <li><i class="fas fa-exclamation-triangle me-2" style="color: #94a3b8;"></i><strong>Common Mistakes</strong> - Errors to avoid</li>
                                <li><i class="fas fa-tasks me-2" style="color: var(--accent-green);"></i><strong>Before You Submit</strong> - Final checklist</li>
                            </ul>
                        </div>
                    ` : ''}

                    <div class="mt-4">
                        <h6 style="color: var(--text-dark); font-weight: 700; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-download" style="background: linear-gradient(135deg, #0284c7, #0d9488); color: white; padding: 0.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(2, 132, 199, 0.25);"></i>
                            Quick Actions
                        </h6>
                        <div class="d-grid gap-3">
                            <a href="${doc.pdf_url}" target="_blank" class="btn btn-lg quick-action-btn-primary" style="background: linear-gradient(135deg, #0284c7, #0d9488); color: white; border: none; border-radius: 12px; box-shadow: 0 4px 16px rgba(2, 132, 199, 0.3); transition: all 0.3s ease; font-weight: 600; padding: 1rem;">
                                <i class="fas fa-file-pdf me-2"></i>Download Official PDF
                            </a>
                            <a href="${doc.info_url}" target="_blank" class="btn btn-lg quick-action-btn-secondary" style="background: white; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 12px; box-shadow: 0 2px 8px rgba(2, 132, 199, 0.1); transition: all 0.3s ease; font-weight: 600; padding: 1rem;">
                                <i class="fas fa-external-link-alt me-2"></i>View Official USCIS Info
                            </a>
                        </div>
                    </div>
                `;
            }

            function renderHowToFillTab() {
                const doc = currentFormData;

                // Show signup prompt for preview mode users
                if (doc.is_preview) {
                    return `
                        <div class="preview-signup-cta" style="margin-top: 0;">
                            <div class="blur-overlay">
                                <i class="fas fa-lock mb-3" style="font-size: 3rem; color: var(--accent-navy);"></i>
                                <h5>Sign up to access filling instructions</h5>
                                <p class="text-muted mb-4">Get step-by-step guidance on how to fill out this form correctly</p>
                                <a href="/login" class="btn btn-primary btn-lg">
                                    <i class="fas fa-user-plus me-2"></i>Create Free Account
                                </a>
                                <p class="mt-3 text-muted small">Already have an account? <a href="/login">Sign in</a></p>
                            </div>
                        </div>
                    `;
                }

                if (!currentFormGuide || !currentFormGuide.filling_steps) {
                    return '<p class="text-center text-muted p-5">Filling guide not available.</p>';
                }

                let html = '<div class="alert alert-info" style="border-radius: 12px;"><i class="fas fa-info-circle me-2"></i><strong>Read each section before filling the form.</strong> Having documents ready makes the process smoother!</div>';

                currentFormGuide.filling_steps.forEach((step, index) => {
                    html += `
                        <div class="guide-section">
                            <h5><i class="fas fa-list-ol me-2"></i>Step ${index + 1}: ${step.part}</h5>
                            <ul>${step.instructions.map(inst => `<li>${inst}</li>`).join('')}</ul>
                            ${step.tips && step.tips.length > 0 ? `
                                <div class="tip-box">
                                    <h6><i class="fas fa-lightbulb me-2"></i>Tips:</h6>
                                    <ul>${step.tips.map(tip => `<li>${tip}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                if (currentFormGuide.pro_tips) {
                    html += `<div class="guide-section" style="border-left-color: var(--accent-green);"><h5><i class="fas fa-star me-2"></i>Pro Tips</h5>`;
                    currentFormGuide.pro_tips.forEach(tip => {
                        html += `<div class="protip-item">${tip}</div>`;
                    });
                    html += '</div>';
                }

                return html;
            }

            // Get enhanced checklist data with pro tips, warnings, and examples
            function getEnhancedChecklistData(item, index) {
                const itemLower = item.toLowerCase();
                let data = {
                    priority: null,
                    priorityColor: '#6c757d',
                    proTip: null,
                    warning: null,
                    example: null
                };

                // Priority detection
                if (index === 0 || itemLower.includes('form') || itemLower.includes('application') || itemLower.includes('petition')) {
                    data.priority = 'CRITICAL';
                    data.priorityColor = '#dc3545';
                } else if (itemLower.includes('passport') || itemLower.includes('birth certificate') || itemLower.includes('photo')) {
                    data.priority = 'IMPORTANT';
                    data.priorityColor = '#fd7e14';
                }

                // Pro Tips based on content
                if (itemLower.includes('passport') && itemLower.includes('photo')) {
                    data.proTip = 'Use a professional photo service that specializes in passport photos to avoid rejections due to incorrect sizing or background.';
                    data.warning = 'Photos older than 6 months or with incorrect backgrounds are a common cause of application delays.';
                }
                else if (itemLower.includes('birth certificate')) {
                    data.proTip = 'Request certified copies directly from the vital records office. Hospital-issued certificates are often not accepted.';
                    data.example = 'Acceptable: State/county vital records certified copy with raised seal. Not acceptable: Hospital certificate, photocopy, or notarized copy.';
                }
                else if (itemLower.includes('marriage certificate')) {
                    data.proTip = 'Get the original long-form certificate from the county clerk, not a ceremonial certificate.';
                    data.warning = 'Ceremonial certificates from wedding venues are not accepted by USCIS.';
                }
                else if (itemLower.includes('passport')) {
                    data.proTip = 'Submit clear, legible copies of ALL pages including blank pages. USCIS may request originals later.';
                    data.example = 'Include bio page, stamps, visas, and any amendments or endorsements.';
                }
                else if (itemLower.includes('photo')) {
                    data.proTip = 'Photos must be 2x2 inches, taken within last 6 months, white/off-white background, no glasses.';
                    data.warning = 'Selfies, filtered photos, or photos with shadows will be rejected.';
                }
                else if (itemLower.includes('i-94')) {
                    data.proTip = 'Download your official I-94 travel history from cbp.gov/I94. Keep both arrival and departure records.';
                    data.example = 'Visit cbp.gov/I94, enter passport details, download PDF with all entry/exit stamps.';
                }
                else if (itemLower.includes('tax') || itemLower.includes('1040')) {
                    data.proTip = 'Include complete returns with all schedules and W-2s. IRS transcripts add credibility.';
                    data.warning = 'Missing schedules or incomplete returns can delay processing by months.';
                }
                else if (itemLower.includes('bank statement')) {
                    data.proTip = 'Submit 3-6 months of consecutive statements showing consistent balance above poverty guidelines.';
                    data.example = 'Official bank statements (not screenshots) with account holder name, account number, and bank letterhead.';
                }
                else if (itemLower.includes('employment letter') || itemLower.includes('job letter')) {
                    data.proTip = 'Letter should be on company letterhead, dated within 30 days, include salary, position, start date, and HR contact.';
                    data.example = 'To Whom It May Concern: This letter confirms [Name] is employed as [Position] since [Date] earning $[Amount]/year. Signed by supervisor or HR.';
                }
                else if (itemLower.includes('translation')) {
                    data.proTip = 'All foreign language documents need certified English translations with translator\'s certification statement.';
                    data.warning = 'Google Translate or uncertified translations will be rejected. Translator must certify competency in both languages.';
                }
                else if (itemLower.includes('affidavit')) {
                    data.proTip = 'Affidavits must be notarized and signed under penalty of perjury. Include affiant\'s ID copy.';
                    data.example = 'Use USCIS affidavit templates. Include "I swear/affirm under penalty of perjury that the foregoing is true and correct."';
                }
                else if (itemLower.includes('evidence') || itemLower.includes('proof')) {
                    data.proTip = 'More evidence is better. Provide multiple types of documentation to strengthen your case.';
                    data.example = 'Combine official documents (leases, insurance) with personal items (photos, messages) for comprehensive evidence.';
                }

                return data;
            }

            function renderChecklistTab() {
                const doc = currentFormData;
                let html = '<h5 class="checklist-section-title"><i class="fas fa-list-check me-2"></i>Required Documents Checklist</h5>';

                if (doc.checklist && doc.checklist.length > 0) {
                    // Debug: Log user tier
                    console.log('User Tier:', userTier);

                    // FREE TIER: Read-only checklist (no interactivity)
                    if (userTier === 'free') {
                        html += `
                            <div class="alert alert-neutral" style="border-radius: 12px; border-left: 4px solid #94a3b8;">
                                <div class="d-flex align-items-start justify-content-between">
                                    <div>
                                        <h6 class="mb-2"><i class="fas fa-eye me-2"></i><strong>Read-Only Checklist</strong></h6>
                                        <p class="mb-0 small">You're viewing the basic checklist. Upgrade for interactive tracking, professional PDFs, and expert guidance.</p>
                                    </div>
                                    <i class="fas fa-lock" style="font-size: 1.5rem; opacity: 0.3;"></i>
                                </div>
                            </div>
                        `;

                        // Render READ-ONLY checklist items (no checkboxes, just bullet points)
                        html += '<div class="mt-3">';
                        doc.checklist.forEach((item, index) => {
                            html += `
                                <div class="checklist-item" style="opacity: 0.85;">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-circle me-3 mt-1" style="font-size: 0.5rem; color: var(--accent-navy);"></i>
                                        <span style="color: #495057; line-height: 1.6;">${item}</span>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';

                        // Upgrade CTA for free users
                        html += `
                            <div class="mt-4 p-4" style="background: linear-gradient(135deg, rgba(180, 83, 9, 0.1) 0%, rgba(15, 118, 110, 0.1) 100%); border-radius: 12px; border: 2px solid var(--brand-purple);">
                                <h5 class="mb-3" style="color: var(--accent-navy);"><i class="fas fa-star me-2" style="color: #0f766e;"></i>Unlock Professional Features</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Interactive checkboxes with progress tracking
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Download PDFs with your name & date
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Professional formatted downloads
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Cover letter templates & I-94 history generator
                                    </div>
                                </div>
                                <div class="text-center mt-3">
                                    <a href="/pricing" class="btn btn-lg" style="background: var(--accent-navy); color: white; border: none; padding: 12px 40px; font-weight: 600; box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);">
                                        <i class="fas fa-arrow-up me-2"></i>Upgrade to Complete Package
                                    </a>
                                    <p class="mt-2 mb-0 small text-muted">See all pricing options on our pricing page</p>
                                </div>
                            </div>
                        `;

                    // ANONYMOUS: Free trial forms (I-130, I-485, N-400) - FULL ACCESS
                    } else if (!isAuthenticated && doc.is_free_trial) {
                        html += `
                            <div class="d-flex align-items-center gap-3 mb-3 p-3" style="background: #d1fae5; border-radius: 8px; border-left: 3px solid var(--accent-green);">
                                <i class="fas fa-gift" style="color: var(--accent-green); font-size: 1.5rem;"></i>
                                <div style="flex: 1;">
                                    <strong style="color: #065f46;">Free - No Login Required</strong>
                                    <p class="mb-0 mt-1" style="font-size: 0.85rem; color: #065f46;">Full checklist access</p>
                                </div>
                            </div>
                        `;

                        // Render FULL checklist items (read-only) for trial forms
                        html += '<div class="mt-3">';
                        doc.checklist.forEach((item, index) => {
                            html += `
                                <div class="checklist-item">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-circle me-3 mt-1" style="font-size: 0.5rem; color: var(--accent-navy);"></i>
                                        <span style="color: #495057; line-height: 1.6;">${item}</span>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';

                        // Signup CTA for anonymous users on trial forms
                        html += `
                            <div class="mt-4 p-4" style="background: linear-gradient(135deg, rgba(180, 83, 9, 0.1) 0%, rgba(15, 118, 110, 0.1) 100%); border-radius: 12px; border: 2px solid var(--brand-purple);">
                                <h5 class="mb-3" style="color: var(--accent-navy);"><i class="fas fa-rocket me-2" style="color: var(--brand-purple);"></i>Sign up to unlock all 11+ forms</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Access to all immigration forms
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Fillable PDF templates
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Complete checklists & guides
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <i class="fas fa-check-circle me-2 text-success"></i>Track your application progress
                                    </div>
                                </div>
                                <div class="text-center">
                                    <a href="/login" class="btn btn-lg" style="background: var(--accent-navy); color: white; border: none; padding: 12px 40px; font-weight: 600; box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);">
                                        <i class="fas fa-user-plus me-2"></i>Create Free Account
                                    </a>
                                    <p class="mt-2 mb-0 small text-muted">Already have an account? <a href="/login">Sign in</a></p>
                                </div>
                            </div>
                        `;

                    // ANONYMOUS: Preview mode (first 3 items) for other forms
                    } else if (!isAuthenticated && doc.is_preview) {
                        html += `<div class="alert alert-info" style="border-radius: 12px; background: var(--accent-navy); color: white; border: none;"><div class="d-flex align-items-center justify-content-between"><div><i class="fas fa-eye me-2"></i><strong>Preview Mode</strong><p class="mb-0 mt-1" style="font-size: 0.9rem;">Showing ${doc.checklist.length} of ${doc.checklist_total} items</p></div><i class="fas fa-lock" style="font-size: 2rem; opacity: 0.3;"></i></div></div>`;

                        // Render preview items (read-only)
                        doc.checklist.forEach((item, index) => {
                            html += `
                                <div class="checklist-item">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-circle me-3 mt-1" style="font-size: 0.5rem; color: var(--accent-navy);"></i>
                                        <span style="color: #495057; line-height: 1.6;">${item}</span>
                                    </div>
                                </div>
                            `;
                        });

                        // Show signup CTA for anonymous users
                        if (doc.checklist_total > doc.checklist.length) {
                            const remainingItems = doc.checklist_total - doc.checklist.length;
                            html += `<div class="preview-signup-cta"><div class="blur-overlay"><i class="fas fa-lock mb-3" style="font-size: 3rem; color: var(--accent-navy);"></i><h5>Sign up to see all ${doc.checklist_total} items</h5><p class="text-muted mb-4">${remainingItems} more checklist items available</p><a href="/login" class="btn btn-primary btn-lg"><i class="fas fa-user-plus me-2"></i>Create Free Account</a><p class="mt-3 text-muted small">Already have an account? <a href="/login">Sign in</a></p></div></div>`;
                        }

                    // PAID TIER: Full interactive checklist with all features
                    } else {
                        html += `
                            <div class="alert alert-success" style="border-radius: 12px;">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <i class="fas fa-check-circle me-2"></i><strong>Professional Checklist with Expert Guidance</strong>
                                        <p class="mb-0 mt-1 small">Interactive tracking + Pro tips + Priority indicators + Professional PDFs</p>
                                    </div>
                                    <span class="badge" style="background: var(--success-green); color: white; padding: 0.5rem 1rem;">
                                        ${getTierDisplayName(userTier)}
                                    </span>
                                </div>
                            </div>
                        `;

                        // Render ENHANCED INTERACTIVE checklist items with pro tips
                        doc.checklist.forEach((item, index) => {
                            // Get enhanced item data (priority, tips, warnings)
                            const enhancedData = getEnhancedChecklistData(item, index);

                            html += `
                                <div class="checklist-item premium-item" style="border-left: 4px solid ${enhancedData.priorityColor};">
                                    <div class="d-flex align-items-start justify-content-between">
                                        <div class="form-check flex-grow-1">
                                            <input class="form-check-input checklist-checkbox" type="checkbox" id="check${index}" data-total="${doc.checklist.length}">
                                            <label class="form-check-label" for="check${index}">
                                                <strong>${item}</strong>
                                                ${enhancedData.priority ? `<span class="badge ms-2" style="background: ${enhancedData.priorityColor}; font-size: 0.7rem;">${enhancedData.priority}</span>` : ''}
                                            </label>
                                        </div>
                                    </div>
                                    ${enhancedData.proTip ? `
                                        <div class="mt-2 ms-4 ps-2" style="border-left: 3px solid #17a2b8; padding-left: 0.75rem;">
                                            <small class="text-info"><i class="fas fa-gem me-1"></i><strong>Pro Tip:</strong> ${enhancedData.proTip}</small>
                                        </div>
                                    ` : ''}
                                    ${enhancedData.warning ? `
                                        <div class="mt-2 ms-4 ps-2" style="border-left: 3px solid #94a3b8; padding-left: 0.75rem;">
                                            <small class="text-muted"><i class="fas fa-exclamation-triangle me-1" style="color: #0f766e;"></i><strong>Note:</strong> ${enhancedData.warning}</small>
                                        </div>
                                    ` : ''}
                                    ${enhancedData.example ? `
                                        <div class="mt-2 ms-4 ps-2" style="background: #f8f9fa; padding: 0.5rem; border-radius: 6px;">
                                            <small class="text-muted"><i class="fas fa-info-circle me-1"></i><strong>Example:</strong> ${enhancedData.example}</small>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });

                        // Progress indicator for paid users
                        html += `<div class="progress-indicator"><div class="progress-text"><i class="fas fa-tasks me-2"></i><span id="checkedCount">0</span> of ${doc.checklist.length} items completed</div><div class="progress"><div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar"></div></div></div>`;

                        // Professional PDF download button for paid users
                        html += `
                            <div class="mt-4 text-center">
                                <button class="btn btn-lg" style="background: var(--accent-navy); color: white; border: none; padding: 12px 40px; font-weight: 600; box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);" onclick="downloadProfessionalPDF(${doc.id})">
                                    <i class="fas fa-file-pdf me-2"></i>Download Professional PDF
                                </button>
                                <p class="mt-2 mb-0 small text-muted">Personalized with your name and today's date</p>
                            </div>
                        `;
                    }
                } else {
                    html += '<p class="text-muted text-center">No checklist available</p>';
                }

                return html;
            }

            function renderMistakesTab() {
                const doc = currentFormData;

                // Show signup prompt for preview mode users
                if (doc.is_preview) {
                    return `
                        <div class="preview-signup-cta" style="margin-top: 0;">
                            <div class="blur-overlay">
                                <i class="fas fa-lock mb-3" style="font-size: 3rem; color: var(--accent-navy);"></i>
                                <h5>Sign up to see common mistakes</h5>
                                <p class="text-muted mb-4">Learn which errors cause delays or rejections so you can avoid them</p>
                                <a href="/login" class="btn btn-primary btn-lg">
                                    <i class="fas fa-user-plus me-2"></i>Create Free Account
                                </a>
                                <p class="mt-3 text-muted small">Already have an account? <a href="/login">Sign in</a></p>
                            </div>
                        </div>
                    `;
                }

                if (!currentFormGuide || !currentFormGuide.common_mistakes) {
                    return '<p class="text-center text-muted p-5">Common mistakes guide not available.</p>';
                }

                let html = '<div class="alert alert-neutral" style="border-radius: 12px;"><h6><i class="fas fa-exclamation-triangle me-2"></i><strong>Avoid These Common Mistakes!</strong></h6><p class="mb-0">These errors cause delays or rejections. Double-check your form!</p></div><div class="mt-4">';

                currentFormGuide.common_mistakes.forEach(mistake => {
                    html += `<div class="mistake-item">${mistake}</div>`;
                });

                return html + '</div>';
            }

            function renderBeforeSubmitTab() {
                const doc = currentFormData;

                // Show signup prompt for preview mode users
                if (doc.is_preview || !isAuthenticated) {
                    return `
                        <div class="preview-signup-cta" style="margin-top: 0;">
                            <div class="blur-overlay">
                                <i class="fas fa-lock mb-3" style="font-size: 3rem; color: var(--accent-navy);"></i>
                                <h5>Sign up for the pre-submission checklist</h5>
                                <p class="text-muted mb-4">Get a final checklist to ensure you have everything before mailing to USCIS</p>
                                <a href="/login" class="btn btn-primary btn-lg">
                                    <i class="fas fa-user-plus me-2"></i>Create Free Account
                                </a>
                                <p class="mt-3 text-muted small">Already have an account? <a href="/login">Sign in</a></p>
                            </div>
                        </div>
                    `;
                }

                if (!currentFormGuide || !currentFormGuide.before_submit) {
                    return '<p class="text-center text-muted p-5">Pre-submission checklist not available.</p>';
                }

                let html = '<div class="alert alert-success" style="border-radius: 12px;"><h6><i class="fas fa-check-circle me-2"></i><strong>Final Checklist Before Mailing</strong></h6><p class="mb-0">Make sure you have everything before mailing to USCIS!</p></div><h5 class="checklist-section-title mt-4"><i class="fas fa-tasks me-2"></i>Before You Submit Checklist</h5>';

                // FREE TIER: Read-only checklist (no checkboxes)
                if (userTier === 'free') {
                    // Render READ-ONLY items
                    currentFormGuide.before_submit.forEach((item, index) => {
                        html += `
                            <div class="checklist-item" style="opacity: 0.85;">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-circle me-3 mt-1" style="font-size: 0.5rem; color: var(--accent-navy);"></i>
                                    <span style="color: #495057; line-height: 1.6;">${item}</span>
                                </div>
                            </div>
                        `;
                    });

                    // Upgrade CTA
                    html += `
                        <div class="mt-4 p-4" style="background: linear-gradient(135deg, rgba(180, 83, 9, 0.1) 0%, rgba(15, 118, 110, 0.1) 100%); border-radius: 12px; border: 2px solid var(--brand-purple);">
                            <h6 class="mb-2" style="color: var(--accent-navy);"><i class="fas fa-lock me-2"></i>Interactive Checklist (Premium Feature)</h6>
                            <p class="mb-3 small text-muted">Upgrade to check off items and track your progress</p>
                            <a href="/pricing" class="btn btn-sm" style="background: var(--accent-navy); color: white;">
                                <i class="fas fa-arrow-up me-2"></i>Upgrade to Complete Package
                            </a>
                        </div>
                    `;
                } else {
                    // PAID TIER: Interactive checkboxes with progress tracking
                    currentFormGuide.before_submit.forEach((item, index) => {
                        html += `<div class="checklist-item"><div class="form-check"><input class="form-check-input checklist-checkbox" type="checkbox" id="submit${index}" data-total="${currentFormGuide.before_submit.length}"><label class="form-check-label" for="submit${index}">${item}</label></div></div>`;
                    });

                    html += `<div class="progress-indicator"><div class="progress-text"><i class="fas fa-tasks me-2"></i><span id="checkedCount">0</span> of ${currentFormGuide.before_submit.length} items completed</div><div class="progress"><div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar"></div></div></div>`;
                }

                html += `<div class="alert alert-info mt-4" style="border-radius: 12px;"><i class="fas fa-info-circle me-2"></i><strong>Remember:</strong> Keep copies! Use certified mail with tracking!</div>`;

                return html;
            }

            function renderMailingTab() {
                const doc = currentFormData;
                const formNumber = doc.title.match(/I-\d+|DS-\d+|N-\d+|AR-\d+/i)?.[0] || '';

                let html = '<h5 class="checklist-section-title"><i class="fas fa-map-marker-alt me-2"></i>Where to Mail Your Application</h5>';

                // Check if form can be filed online
                const onlineFilingForms = ['I-130', 'I-485', 'I-765', 'I-131', 'I-90', 'I-129', 'I-140', 'I-539', 'N-400', 'N-600'];
                const canFileOnline = onlineFilingForms.some(form => formNumber.toUpperCase() === form);

                if (canFileOnline) {
                    html += `
                        <div class="alert alert-info" style="border-radius: 12px; background: linear-gradient(135deg, rgba(180, 83, 9, 0.1) 0%, rgba(15, 118, 110, 0.1) 100%); border-left: 4px solid var(--brand-purple);">
                            <h6><i class="fas fa-laptop me-2"></i><strong>Online Filing Available!</strong></h6>
                            <p class="mb-2">You can file ${formNumber} online through USCIS. This is the recommended method if you have:</p>
                            <ul class="mb-2">
                                <li>Reliable computer and internet connection</li>
                                <li>Ability to scan and upload documents (PDF format)</li>
                                <li>Credit/debit card for fee payment</li>
                            </ul>
                            <p class="mb-2"><strong>Benefits of Online Filing:</strong></p>
                            <ul class="mb-3">
                                <li>✅ Faster processing - no mail delays</li>
                                <li>✅ Instant confirmation receipt</li>
                                <li>✅ Track status online immediately</li>
                                <li>✅ Get updates via email/text</li>
                                <li>✅ No risk of lost mail</li>
                            </ul>
                            <a href="https://my.uscis.gov/account" target="_blank" class="btn btn-primary">
                                <i class="fas fa-external-link-alt me-2"></i>File ${formNumber} Online at my.uscis.gov
                            </a>
                        </div>
                    `;
                }

                // PAID USERS: Interactive personalized address selector
                if (userTier !== 'free') {
                    html += `
                        <div class="alert alert-success" style="border-radius: 12px; margin-top: 1.5rem;">
                            <h6><i class="fas fa-star me-2"></i><strong>Personalized Mailing Address (Premium Feature)</strong></h6>
                            <p class="mb-0">Answer a few questions to get your exact mailing address</p>
                        </div>
                    `;

                    // Get address options for this form
                    const addressOptions = getAddressOptions(formNumber);

                    if (addressOptions.questions) {
                        html += `
                            <div class="card" style="border-radius: 12px; border: 2px solid var(--brand-purple); margin-top: 1.5rem;">
                                <div class="card-body p-4">
                                    <div id="addressQuestions">
                        `;

                        // Render questions
                        addressOptions.questions.forEach((question, qIndex) => {
                            html += `
                                <div class="mb-4">
                                    <label class="form-label" style="font-weight: 600; color: var(--accent-navy);">
                                        <i class="fas fa-question-circle me-2"></i>${question.text}
                                    </label>
                                    <select class="form-select form-select-lg" id="addressQ${qIndex}" onchange="updateMailingAddress('${formNumber}')">
                                        <option value="">-- Select --</option>
                                        ${question.options.map(opt => `<option value="${opt.value}" ${opt.disabled ? 'disabled' : ''}>${opt.label}</option>`).join('')}
                                    </select>
                                </div>
                            `;
                        });

                        html += `
                                    </div>
                                    <div id="selectedAddress" style="display: none;">
                                        <div class="alert alert-success" style="border-radius: 12px; margin-top: 1.5rem;">
                                            <h6><i class="fas fa-check-circle me-2"></i><strong>Your Mailing Address:</strong></h6>
                                        </div>
                                        <div id="addressDisplay" style="background: linear-gradient(135deg, rgba(180, 83, 9, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%); padding: 2rem; border-radius: 12px; border-left: 4px solid var(--brand-purple);">
                                            <!-- Address will be displayed here -->
                                        </div>
                                        <div class="mt-3 text-center">
                                            <button class="btn btn-lg" style="background: var(--accent-navy); color: white;" onclick="copyMailingAddress(event)">
                                                <i class="fas fa-copy me-2"></i>Copy Address
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Simple form - just show the address
                        const mailingInfo = getMailingAddresses(formNumber);
                        html += '<div class="mt-3">';
                        mailingInfo.forEach((info, index) => {
                            html += `
                                <div class="card mb-3" style="border-radius: 12px; border: 2px solid var(--success-green);">
                                    <div class="card-body">
                                        <h6 class="card-title" style="color: var(--accent-navy);">
                                            <i class="fas fa-map-pin me-2"></i>${info.title}
                                        </h6>
                                        <div style="background: #F9FAFB; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem; line-height: 1.8;">
                                            ${info.address.split('\n').join('<br>')}
                                        </div>
                                        ${info.note ? `<p class="mt-2 mb-0 small text-muted"><i class="fas fa-info-circle me-1"></i>${info.note}</p>` : ''}
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-outline-primary" onclick="copyAddress('${info.address.replace(/'/g, "\\'")}', event)">
                                                <i class="fas fa-copy me-1"></i>Copy Address
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                    }

                // FREE USERS: Show upgrade prompt
                } else {
                    html += `
                        <div class="alert alert-neutral" style="border-radius: 12px; margin-top: 1.5rem;">
                            <h6><i class="fas fa-envelope me-2"></i><strong>If Filing by Mail:</strong></h6>
                            <p class="mb-0">Mailing addresses vary by your location and form type.</p>
                        </div>
                    `;

                    // Get mailing addresses based on form type
                    const mailingInfo = getMailingAddresses(formNumber);

                    html += '<div class="mt-3">';
                    mailingInfo.forEach((info, index) => {
                        html += `
                            <div class="card mb-3" style="border-radius: 12px; border: 2px solid var(--border-gray); opacity: 0.7;">
                                <div class="card-body">
                                    <h6 class="card-title" style="color: var(--accent-navy);">
                                        <i class="fas fa-map-pin me-2"></i>${info.title}
                                    </h6>
                                    <div style="background: #F9FAFB; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem; line-height: 1.8;">
                                        ${info.address.split('\n').join('<br>')}
                                    </div>
                                    ${info.note ? `<p class="mt-2 mb-0 small text-muted"><i class="fas fa-info-circle me-1"></i>${info.note}</p>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';

                    html += `
                        <div class="text-center mt-4 p-4" style="background: linear-gradient(135deg, rgba(180, 83, 9, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%); border-radius: 12px; border: 2px solid var(--brand-purple);">
                            <i class="fas fa-star" style="font-size: 2rem; color: #0f766e; margin-bottom: 1rem;"></i>
                            <h5>Get Personalized Mailing Address</h5>
                            <p class="text-muted mb-3">Upgrade to get your exact mailing address based on your location and case type</p>
                            <a href="/pricing" class="btn btn-lg" style="background: var(--accent-navy); color: white;">
                                <i class="fas fa-arrow-up me-2"></i>Upgrade Now
                            </a>
                        </div>
                    `;
                }

                // Add important mailing tips
                html += `
                    <div class="alert alert-success mt-4" style="border-radius: 12px;">
                        <h6><i class="fas fa-envelope-open-text me-2"></i><strong>Important Mailing Tips:</strong></h6>
                        <ul class="mb-0">
                            <li><strong>Use certified mail with return receipt</strong> - This provides proof of delivery</li>
                            <li><strong>Keep photocopies</strong> - Make copies of everything you send</li>
                            <li><strong>Check fees</strong> - Verify current fees at uscis.gov before mailing</li>
                            <li><strong>Organize your packet</strong> - Use the checklist tab to ensure you have everything</li>
                            <li><strong>Sign and date</strong> - Unsigned applications will be rejected</li>
                            <li><strong>Track your package</strong> - Keep the tracking number until you receive confirmation</li>
                        </ul>
                    </div>
                `;

                html += `
                    <div class="text-center mt-4">
                        <p class="text-muted small">
                            <i class="fas fa-exclamation-circle me-1"></i>
                            <strong>Note:</strong> USCIS addresses change occasionally. Always verify at
                            <a href="https://www.uscis.gov/forms" target="_blank">uscis.gov/forms</a> before mailing.
                        </p>
                    </div>
                `;

                return html;
            }

            function getMailingAddresses(formNumber) {
                // Comprehensive mailing addresses for common forms
                const addresses = {
                    'I-130': [
                        {
                            title: 'For U.S. Residents',
                            address: 'USCIS\nAttn: I-130\nP.O. Box 4136\nChicago, IL 60680-4136',
                            note: 'Most applicants living in the United States use this address'
                        },
                        {
                            title: 'If Filing from Outside the U.S.',
                            address: 'USCIS\nAttn: I-130\n131 M Street NE\nWashington, DC 20529',
                            note: 'For petitioners residing outside the United States'
                        }
                    ],
                    'I-485': [
                        {
                            title: 'For Employment-Based Cases',
                            address: 'USCIS\nP.O. Box 805887\nChicago, IL 60680-4120',
                            note: 'Use this if filing based on employment (EB-1, EB-2, EB-3, etc.)'
                        },
                        {
                            title: 'For Family-Based Cases',
                            address: 'USCIS\nP.O. Box 805371\nChicago, IL 60680-4120',
                            note: 'Use this if filing based on family relationship (marriage, parent, sibling, etc.)'
                        }
                    ],
                    'I-765': [
                        {
                            title: 'Standard Mailing Address',
                            address: 'USCIS\nP.O. Box 6943\nChicago, IL 60680-6943',
                            note: 'For most I-765 applications (EAD work permit)'
                        }
                    ],
                    'I-131': [
                        {
                            title: 'Standard Mailing Address',
                            address: 'USCIS\nP.O. Box 6939\nChicago, IL 60680-6939',
                            note: 'For advance parole / travel document applications'
                        }
                    ],
                    'N-400': [
                        {
                            title: 'Standard Mailing Address',
                            address: 'USCIS\nP.O. Box 21251\nPhoenix, AZ 85036',
                            note: 'For naturalization (citizenship) applications'
                        }
                    ],
                    'I-864': [
                        {
                            title: 'File with Primary Form',
                            address: 'Do not mail separately',
                            note: 'I-864 Affidavit of Support should be included with your I-485 or immigrant visa packet - do not mail separately'
                        }
                    ],
                    'I-90': [
                        {
                            title: 'Standard Mailing Address',
                            address: 'USCIS\nP.O. Box 21262\nPhoenix, AZ 85036',
                            note: 'For green card replacement/renewal'
                        }
                    ]
                };

                // Return addresses or default message
                if (addresses[formNumber]) {
                    return addresses[formNumber];
                }

                // Default message if specific form not found
                return [{
                    title: 'Check USCIS Website',
                    address: 'Visit uscis.gov/forms\nFind your form number\nClick "Direct Filing Addresses"',
                    note: `Mailing addresses for ${formNumber || 'this form'} vary by location and case type. Please check the USCIS website for the most current address.`
                }];
            }

            function getAddressOptions(formNumber) {
                // US States and territories for dropdown
                const stateOptions = [
                    { label: 'Alabama', value: 'AL' },
                    { label: 'Alaska', value: 'AK' },
                    { label: 'Arizona', value: 'AZ' },
                    { label: 'Arkansas', value: 'AR' },
                    { label: 'California', value: 'CA' },
                    { label: 'Colorado', value: 'CO' },
                    { label: 'Connecticut', value: 'CT' },
                    { label: 'Delaware', value: 'DE' },
                    { label: 'District of Columbia', value: 'DC' },
                    { label: 'Florida', value: 'FL' },
                    { label: 'Georgia', value: 'GA' },
                    { label: 'Hawaii', value: 'HI' },
                    { label: 'Idaho', value: 'ID' },
                    { label: 'Illinois', value: 'IL' },
                    { label: 'Indiana', value: 'IN' },
                    { label: 'Iowa', value: 'IA' },
                    { label: 'Kansas', value: 'KS' },
                    { label: 'Kentucky', value: 'KY' },
                    { label: 'Louisiana', value: 'LA' },
                    { label: 'Maine', value: 'ME' },
                    { label: 'Maryland', value: 'MD' },
                    { label: 'Massachusetts', value: 'MA' },
                    { label: 'Michigan', value: 'MI' },
                    { label: 'Minnesota', value: 'MN' },
                    { label: 'Mississippi', value: 'MS' },
                    { label: 'Missouri', value: 'MO' },
                    { label: 'Montana', value: 'MT' },
                    { label: 'Nebraska', value: 'NE' },
                    { label: 'Nevada', value: 'NV' },
                    { label: 'New Hampshire', value: 'NH' },
                    { label: 'New Jersey', value: 'NJ' },
                    { label: 'New Mexico', value: 'NM' },
                    { label: 'New York', value: 'NY' },
                    { label: 'North Carolina', value: 'NC' },
                    { label: 'North Dakota', value: 'ND' },
                    { label: 'Ohio', value: 'OH' },
                    { label: 'Oklahoma', value: 'OK' },
                    { label: 'Oregon', value: 'OR' },
                    { label: 'Pennsylvania', value: 'PA' },
                    { label: 'Rhode Island', value: 'RI' },
                    { label: 'South Carolina', value: 'SC' },
                    { label: 'South Dakota', value: 'SD' },
                    { label: 'Tennessee', value: 'TN' },
                    { label: 'Texas', value: 'TX' },
                    { label: 'Utah', value: 'UT' },
                    { label: 'Vermont', value: 'VT' },
                    { label: 'Virginia', value: 'VA' },
                    { label: 'Washington', value: 'WA' },
                    { label: 'West Virginia', value: 'WV' },
                    { label: 'Wisconsin', value: 'WI' },
                    { label: 'Wyoming', value: 'WY' },
                    { label: '────────────────', value: 'separator', disabled: true },
                    { label: 'Outside the United States', value: 'OUTSIDE' }
                ];

                // Define interactive questions for forms with multiple addresses
                const options = {
                    'I-130': {
                        questions: [
                            {
                                text: 'Where are you currently residing?',
                                options: stateOptions
                            }
                        ],
                        getAddress: function(state) {
                            if (state === 'OUTSIDE') {
                                return {
                                    title: 'For Petitioners Outside the U.S.',
                                    address: 'USCIS\nAttn: I-130\n131 M Street NE\nWashington, DC 20529',
                                    note: 'Use this address for petitioners residing outside the United States'
                                };
                            } else {
                                return {
                                    title: `For Residents of ${state}`,
                                    address: 'USCIS\nAttn: I-130\nP.O. Box 4136\nChicago, IL 60680-4136',
                                    note: 'All U.S. residents mail I-130 to the Chicago Lockbox'
                                };
                            }
                        }
                    },
                    'I-485': {
                        questions: [
                            {
                                text: 'What state do you currently live in?',
                                options: stateOptions.filter(opt => opt.value !== 'OUTSIDE')
                            },
                            {
                                text: 'What is the basis of your green card application?',
                                options: [
                                    { label: 'Family-Based (marriage, parent, sibling, etc.)', value: 'family' },
                                    { label: 'Employment-Based (EB-1, EB-2, EB-3, etc.)', value: 'employment' }
                                ]
                            }
                        ],
                        getAddress: function(state, basis) {
                            if (basis === 'family') {
                                return {
                                    title: `For Family-Based Cases (${state})`,
                                    address: 'USCIS\nP.O. Box 805371\nChicago, IL 60680-4120',
                                    note: 'All family-based I-485 applications mail to Chicago Lockbox'
                                };
                            } else {
                                return {
                                    title: `For Employment-Based Cases (${state})`,
                                    address: 'USCIS\nP.O. Box 805887\nChicago, IL 60680-4120',
                                    note: 'All employment-based I-485 applications mail to Chicago Lockbox'
                                };
                            }
                        }
                    },
                    'N-400': {
                        questions: [
                            {
                                text: 'What state do you currently live in?',
                                options: stateOptions.filter(opt => opt.value !== 'OUTSIDE')
                            }
                        ],
                        getAddress: function(state) {
                            return {
                                title: `For Residents of ${state}`,
                                address: 'USCIS\nP.O. Box 21251\nPhoenix, AZ 85036',
                                note: 'All N-400 naturalization applications mail to the Phoenix Lockbox'
                            };
                        }
                    },
                    'I-765': {
                        questions: [
                            {
                                text: 'What state do you currently live in?',
                                options: stateOptions.filter(opt => opt.value !== 'OUTSIDE')
                            }
                        ],
                        getAddress: function(state) {
                            return {
                                title: `For Residents of ${state}`,
                                address: 'USCIS\nP.O. Box 6943\nChicago, IL 60680-6943',
                                note: 'All I-765 work permit applications mail to Chicago Lockbox'
                            };
                        }
                    },
                    'I-131': {
                        questions: [
                            {
                                text: 'What state do you currently live in?',
                                options: stateOptions.filter(opt => opt.value !== 'OUTSIDE')
                            }
                        ],
                        getAddress: function(state) {
                            return {
                                title: `For Residents of ${state}`,
                                address: 'USCIS\nP.O. Box 6939\nChicago, IL 60680-6939',
                                note: 'All I-131 advance parole applications mail to Chicago Lockbox'
                            };
                        }
                    },
                    'I-90': {
                        questions: [
                            {
                                text: 'What state do you currently live in?',
                                options: stateOptions.filter(opt => opt.value !== 'OUTSIDE')
                            }
                        ],
                        getAddress: function(state) {
                            return {
                                title: `For Residents of ${state}`,
                                address: 'USCIS\nP.O. Box 21262\nPhoenix, AZ 85036',
                                note: 'All I-90 green card renewal applications mail to Phoenix Lockbox'
                            };
                        }
                    }
                };

                return options[formNumber] || {};
            }

            window.updateMailingAddress = function(formNumber) {
                const addressOptions = getAddressOptions(formNumber);
                if (!addressOptions.questions) return;

                // Get all answers
                const answers = addressOptions.questions.map((q, i) => {
                    return document.getElementById(`addressQ${i}`).value;
                });

                // Check if all questions answered
                if (answers.some(a => !a || a === 'separator')) return;

                // Use the getAddress function with answers
                const selectedAddress = addressOptions.getAddress(...answers);

                if (selectedAddress) {
                    // Display the personalized address
                    const addressHTML = `
                        <h5 style="color: var(--accent-navy); margin-bottom: 1.5rem;">
                            <i class="fas fa-envelope me-2"></i>${selectedAddress.title}
                        </h5>
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 1.1rem; line-height: 2; border: 2px solid var(--success-green); margin-bottom: 1rem;" id="addressToCopy">
                            ${selectedAddress.address.split('\n').join('<br>')}
                        </div>
                        ${selectedAddress.note ? `<p class="text-muted mb-0"><i class="fas fa-info-circle me-1"></i>${selectedAddress.note}</p>` : ''}
                    `;

                    document.getElementById('addressDisplay').innerHTML = addressHTML;
                    document.getElementById('selectedAddress').style.display = 'block';

                    // Scroll to address
                    document.getElementById('selectedAddress').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            };

            window.copyMailingAddress = function(event) {
                const addressElement = document.getElementById('addressToCopy');
                if (!addressElement) {
                    showToast('Error: Address not found', 'error');
                    return;
                }

                const addressText = addressElement.innerText;

                navigator.clipboard.writeText(addressText).then(() => {
                    // Show success feedback
                    const btn = event.target.closest('button');
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';

                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                    }, 2000);

                    showToast('Address copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    showToast('Failed to copy. Please select and copy manually.', 'error');
                });
            };

            window.copyAddress = function(address, event) {
                const addressText = address.replace(/<br>/g, '\n').replace(/\\/g, '');

                navigator.clipboard.writeText(addressText).then(() => {
                    // Show success feedback
                    const btn = event.target.closest('button');
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                    btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-success');
                    btn.classList.add('text-white');

                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.classList.remove('btn-success');
                        btn.classList.remove('text-white');
                        btn.classList.add('btn-outline-primary');
                    }, 2000);

                    showToast('Address copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    showToast('Failed to copy. Please select and copy manually.', 'error');
                });
            };

            // Toast notification helper
            function showToast(message, type = 'info') {
                // Remove any existing toasts
                const existingToast = document.querySelector('.custom-toast');
                if (existingToast) {
                    existingToast.remove();
                }

                // Create toast element
                const toast = document.createElement('div');
                toast.className = 'custom-toast';

                const bgColor = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
                const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';

                toast.innerHTML = `
                    <i class="fas ${icon} me-2"></i>${message}
                `;

                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${bgColor};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    font-weight: 500;
                    animation: slideIn 0.3s ease-out;
                `;

                document.body.appendChild(toast);

                // Remove after 3 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // Download Professional PDF (for paid users only)
            window.downloadProfessionalPDF = function(formId) {
                // Show loading state
                const btn = event.target.closest('button');
                const originalHtml = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating PDF...';

                // Make AJAX call to download PDF
                $.ajax({
                    url: `/api/forms/${formId}/checklist-pdf`,
                    method: 'GET',
                    xhrFields: {
                        responseType: 'blob'
                    },
                    success: function(blob) {
                        // Create download link
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${currentFormData.title.replace('/', '-')}_Checklist.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        // Reset button
                        btn.disabled = false;
                        btn.innerHTML = originalHtml;

                        // Show success message
                        alert('PDF downloaded successfully!');
                    },
                    error: function(xhr) {
                        // Reset button
                        btn.disabled = false;
                        btn.innerHTML = originalHtml;

                        // Show error message
                        if (xhr.status === 403) {
                            alert('Please upgrade to access professional PDF downloads.');
                            window.location.href = '/pricing';
                        } else {
                            alert('Error generating PDF. Please try again.');
                        }
                    }
                });
            };

            // Logout handler
            $('#logoutBtn').click(async function() {
                try {
                    // Logout from Flask
                    await $.post('/api/auth/logout');

                    // Sign out from Clerk if available
                    if (typeof Clerk !== 'undefined' && Clerk.signOut) {
                        await Clerk.signOut();
                    }

                    // Redirect to home
                    window.location.href = '/';
                } catch (error) {
                    console.error('Logout error:', error);
                    // Force redirect even on error
                    window.location.href = '/';
                }
            });

            // Auth redirect
            $('#loginBtn').click(function() {
                window.location.href = '/login';
            });

            // Page loading indicator
            const loadingBar = document.getElementById('pageLoadingBar');

            // Show loading bar on navigation
            document.addEventListener('click', function(e) {
                const link = e.target.closest('a');
                if (link && link.href && !link.target && !link.href.includes('#') &&
                    !link.href.includes('mailto:') && !link.href.includes('javascript:')) {
                    loadingBar.classList.add('loading');
                }
            });

            // Complete loading bar when page loads
            window.addEventListener('load', function() {
                loadingBar.classList.add('complete');
                setTimeout(function() {
                    loadingBar.classList.remove('loading', 'complete');
                    loadingBar.style.width = '0%';
                    loadingBar.style.opacity = '1';
                }, 400);
            });

            // Start loading bar on DOMContentLoaded
            if (document.readyState === 'loading') {
                loadingBar.classList.add('loading');
            }
        });
    </script>

    <!-- Professional Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-grid">
                <!-- Company Info -->
                <div class="footer-column footer-brand">
                    <h3>Immigration Templates</h3>
                    <p class="footer-tagline">Simplifying Your Immigration Journey</p>
                    <p class="footer-description">
                        Professional immigration form templates, comprehensive checklists, and document preparation tools. Access USCIS-compliant resources for I-130, I-485, N-400, and more. Expert guidance for every step of your immigration process.
                    </p>
                </div>

                <!-- Quick Links -->
                <div class="footer-column">
                    <h4>Product</h4>
                    <ul class="footer-links">
                        <li><a href="/forms">Forms Library</a></li>
                        <li><a href="/templates">Templates</a></li>
                        <li><a href="/file-compressor">File Compressor</a></li>
                        <li><a href="/pricing">Pricing</a></li>
                    </ul>
                </div>

                <!-- Legal Links -->
                <div class="footer-column">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="footer-column">
                    <h4>Contact</h4>
                    <ul class="footer-contact">
                        <li>
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:support@immigrationtemplates.com">support@immigrationtemplates.com</a>
                        </li>
                        <li>
                            <i class="fas fa-globe"></i>
                            <a href="https://www.immigrationtemplates.com" target="_blank">Visit Website</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Trust Badges -->
            <div class="footer-trust-badges">
                <div class="trust-badge-item">
                    <i class="fas fa-lock"></i>
                    <span>SSL Secured</span>
                </div>
                <div class="trust-badge-item">
                    <i class="fas fa-credit-card"></i>
                    <span>Powered by Stripe</span>
                </div>
                <div class="trust-badge-item">
                    <i class="fas fa-file-alt"></i>
                    <span>USCIS Resources</span>
                </div>
                <div class="trust-badge-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure & Compliant</span>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <p class="footer-copyright">
                    © 2024 Immigration Templates. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
</body>
</html>
